<HTML
><HEAD
><TITLE
>Using 
QDataTable</TITLE
><META
NAME="GENERATOR"
CONTENT="Modular DocBook HTML Stylesheet Version 1.57"><LINK
REL="HOME"
HREF="book1.html"><LINK
REL="UP"
TITLE="Creating Database Applications"
HREF="creating-database-applications.html"><LINK
REL="PREVIOUS"
TITLE="Creating Database Applications"
HREF="creating-database-applications.html"><LINK
REL="NEXT"
TITLE="Using 
QDataBrowser and 
QDataView"
HREF="using-qdatabrowser-and-qdataview.html"></HEAD
><BODY
CLASS="SECT1"
><DIV
CLASS="NAVHEADER"
><TABLE
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TH
COLSPAN="3"
ALIGN="center"
></TH
></TR
><TR
><TD
WIDTH="10%"
ALIGN="left"
VALIGN="bottom"
><A
HREF="creating-database-applications.html"
>Prev</A
></TD
><TD
WIDTH="80%"
ALIGN="center"
VALIGN="bottom"
>Chapter 6. Creating Database Applications</TD
><TD
WIDTH="10%"
ALIGN="right"
VALIGN="bottom"
><A
HREF="using-qdatabrowser-and-qdataview.html"
>Next</A
></TD
></TR
></TABLE
><HR
ALIGN="LEFT"
WIDTH="100%"></DIV
><DIV
CLASS="SECT1"
><H1
CLASS="SECT1"
><A
NAME="USING-QDATATABLE"
>Using 
<TT
CLASS="CLASSNAME"
>QDataTable</TT
></A
></H1
><P
>    
<TT
CLASS="CLASSNAME"
>QDataTable</TT
>s may be placed on any form to provide browsing
    of database tables and views. 
<TT
CLASS="CLASSNAME"
>QDataTable</TT
>s can also be used
    to update or delete records in-place, i.e. inside the cells
    themselves. Inserting records via a 
<TT
CLASS="CLASSNAME"
>QDataTable</TT
> usually
    requires connecting to the 
<TT
CLASS="FUNCTION"
>primeInsert()</TT
> signal, so that we
    can generate primary keys for example, or provide default values.
    If we wish to present records using a form view (perhaps combining
    data from several tables and views) we might use several
    
<TT
CLASS="CLASSNAME"
>QDataBrowser</TT
>s and 
<TT
CLASS="CLASSNAME"
>QDataView</TT
>s.
    </P
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="QUICKLY-VIEWING-A-DATABASE-TABLE"
>Quickly Viewing a Database Table</A
></H2
><P
>	This example, along with all the other examples in this chapter,
	has the project name 'book' and uses the database created by
	the 
<TT
CLASS="FILENAME"
>book.sql</TT
> script. As we work through the chapter
	we will build the 'book' application step by step. Create or copy the
	<TT
CLASS="FILENAME"
>qt/tools/designer/examples/book/book1/main.cpp</TT
> file shown
	earlier. The project file for this first example is
	<TT
CLASS="FILENAME"
>qt/tools/designer/examples/book/book1/book.pro</TT
>. Start a new
	project by clicking 
<SPAN
CLASS="GUIMENUITEM"
>File|New Project</SPAN
>. Complete
	the 
Project Settings dialog by entering a project name and
	a project file name. Now click 
<SPAN
CLASS="GUIMENUITEM"
>Edit|Database Connections</SPAN
>.
	Fill in the
	connection information appropriate to your database then press
	<SPAN
CLASS="GUIBUTTON"
>Connect</SPAN
>. The connection name should now appear in
	the left hand list box. (If this doesn't happen you'll need to
	contact your database systems administrator for help.) Close the
	dialog.
	</P
><P
>	We will now create a new form with a 
<TT
CLASS="CLASSNAME"
>QDataTable</TT
> that's
	connected to one of our database tables.
	</P
><P
>	Click 
<SPAN
CLASS="GUIMENUITEM"
>File|New</SPAN
>. The 
New Form dialog presents us
	with a number of form templates to choose from. Choose the
	'Dialog' form and click <SPAN
CLASS="GUIBUTTON"
>OK</SPAN
>. Now click
	
<SPAN
CLASS="GUIMENUITEM"
>File|Save</SPAN
>. You will be prompted for a filename,
	call it <TT
CLASS="FILENAME"
>book.ui</TT
>.
	</P
><DIV
CLASS="SECT3"
><H3
CLASS="SECT3"
><A
NAME="SETTING-UP-A-QDATATABLE"
>Setting up a 
<TT
CLASS="CLASSNAME"
>QDataTable</TT
></A
></H3
><P
>	    

	    

	    To place a 
<TT
CLASS="CLASSNAME"
>QDataTable</TT
> widget on the form either
	    click 
<SPAN
CLASS="GUIMENUITEM"
>Tools|Views|QDataTable</SPAN
> or click the
	    

<SPAN
CLASS="GUIBUTTON"
>QDataTable</SPAN
> toolbar button. Click on the form and
	    the SQL Table Wizard will appear.

	    <P
></P
><OL
TYPE="1"
><LI
><P
>		    The <I
CLASS="EMPHASIS"
>Database Connection and Table</I
>
		    wizard page is used to set up a connection if one
		    doesn't exist and to choose the table or view for
		    the 
<TT
CLASS="CLASSNAME"
>QDataTable</TT
>. (See <A
HREF="creating-database-applications.html#SETTING-UP-QT-DESIGNERS-CONNECTIONS"
>the section called <I
>Setting Up <I
CLASS="EMPHASIS"
>Qt Designer</I
>'s Connections</I
></A
>
		    "Setting Up <I
CLASS="EMPHASIS"
>Qt Designer</I
>'s Connections".)
		    </P
><P
>		    Click the connection you wish to use, listed in the
		    left hand list box, e.g. "(default)". The available
		    tables and views will appear in the right hand Table
		    list box. Click the 'author' table and then click
		    the <SPAN
CLASS="GUIBUTTON"
>Next</SPAN
> button.
		    </P
></LI
><LI
><P
>		    The <I
CLASS="EMPHASIS"
>Displayed Fields</I
> wizard page
		    provides a means of selecting which fields should be
		    displayed in the 
<TT
CLASS="CLASSNAME"
>QDataTable</TT
> and in what
		    order. By default all fields except the primary key
		    (if there is one) are in the Displayed Fields list
		    box. The left- and right-pointing blue arrow buttons
		    can be used to move fields between the Displayed
		    Fields and the Available Fields list boxes. The blue
		    up and down pointing arrow buttons are used to
		    select the display order of the displayed fields.
		    </P
><P
>		    The default settings are the ones we want so simply
		    click <SPAN
CLASS="GUIBUTTON"
>Next</SPAN
>.
		    </P
></LI
><LI
><P
>		    

		    The <I
CLASS="EMPHASIS"
>Table Properties</I
> wizard page provides
		    convenient access to some of the database-related
		    properties of the 
<TT
CLASS="CLASSNAME"
>QDataTable</TT
>.
		    </P
><P
>		    Make sure the Confirm Deletes checkbox is checked,
		    then click <SPAN
CLASS="GUIBUTTON"
>Next</SPAN
>.
		    </P
></LI
><LI
><P
>		    The <I
CLASS="EMPHASIS"
>SQL</I
> wizard page is used to set the
		    
<TT
CLASS="CLASSNAME"
>QDataTable</TT
>'s Filter and Sort properties. The
		    Filter is an SQL <TT
CLASS="LITERAL"
>WHERE</TT
> clause (without
		    the word 'WHERE'). For example, to only list authors
		    whose surnames begin with 'P', we would enter
		    <TT
CLASS="LITERAL"
>title LIKE 'P%'</TT
>. We'll leave
		    the filter empty. The Available Fields list box
		    lists all the fields. The Sort By list box lists the
		    fields that the 
<TT
CLASS="CLASSNAME"
>QDataTable</TT
> is to sort by and
		    the direction of their sorting (ASCending or
		    DESCending). The left and right blue arrows are used
		    to move fields between the two list boxes. The up
		    and down blue arrows move fields up and down within
		    the Sort By list box. The ASC or DESC setting is
		    changed with the 'sort order' toolbar button.
		    </P
><P
>		    Move the surname and forename fields into the Sort By
		    list box and click <SPAN
CLASS="GUIBUTTON"
>Next</SPAN
>.
		    </P
></LI
><LI
><P
>		    The <I
CLASS="EMPHASIS"
>Finish</I
> wizard page gives us the
		    opportunity to go back and change any of our
		    settings. We will be able to change them later
		    through the 
<TT
CLASS="CLASSNAME"
>QDataTable</TT
>'s properties so we
		    can finish with the wizard.
		    </P
><P
>		    Click <SPAN
CLASS="GUIBUTTON"
>Finish</SPAN
>.
		    </P
></LI
></OL
>
	    </P
><P
>	    The table will appear on the form with each column labelled with
	    a default column name. If you wish to change the settings
	    then most of them are available in the property window. The
	    display names, the fields they are based upon, and the order
	    of appearance of the columns can be changed using the 
	    
Edit Table dialog (explained later) by right clicking the
	    
<TT
CLASS="CLASSNAME"
>QDataTable</TT
> and left clicking <SPAN
CLASS="GUIBUTTON"
>Edit</SPAN
>.
	    </P
></DIV
><DIV
CLASS="SECT3"
><H3
CLASS="SECT3"
><A
NAME="AEN4703"
>Laying out the Form</A
></H3
><P
>	    Click on the form and click the 

<SPAN
CLASS="GUIBUTTON"
>Lay Out Vertically</SPAN
>
	    toolbar button. Now click 
<SPAN
CLASS="GUIMENUITEM"
>Preview|Preview Form</SPAN
>;
	    the form will run and the table will automatically display all
	    the records.
	    </P
><P
>	    To turn the form we've created into an executable application we
	    must add the 
<TT
CLASS="FILENAME"
>main.cpp</TT
> file to the project file and
	    make the project. We should also do some renaming to make things
	    easier to understand.

	    <P
></P
><OL
TYPE="1"
><LI
><P
>		    Click on the form and change its name to 'BookForm'
		    and its caption to 'Book'. Click on the
		    
<TT
CLASS="CLASSNAME"
>QDataTable</TT
> and change its name to
		    'AuthorDataTable'.
		    </P
></LI
><LI
><P
>		    Click 
<SPAN
CLASS="GUIMENUITEM"
>File|Save All</SPAN
>.
		    </P
></LI
><LI
><P
>		    Open the project file, e.g. 
<TT
CLASS="FILENAME"
>book.pro</TT
>, in a
		    plain text editor and add the line:
		    <TT
CLASS="LITERAL"
>SOURCES += main.cpp</TT
>
		    at the end of the file.
		    </P
></LI
><LI
><P
>		    Run 
<B
CLASS="COMMAND"
>qmake</B
> to generate the make file,
		    e.g. <TT
CLASS="LITERAL"
>qmake -o Makefile book.pro</TT
>, then make
		    and run the <B
CLASS="COMMAND"
>book</B
> program.
		    </P
></LI
></OL
>
	    </P
><P
>	    This example shows how easy it is to use 
<TT
CLASS="CLASSNAME"
>QDataTable</TT
>
	    to show the contents of a database table or view. You can
	    use the application we've just built to update and delete
	    author records. In the examples that follow we will cover
	    insertions, setting up master-detail relationships,
	    drilldown and foreign key lookups.
	    </P
><TABLE
CLASS="SIDEBAR"
BORDER="1"
CELLPADDING="5"
><TR
><TD
><DIV
CLASS="SIDEBAR"
><A
NAME="AEN4752"
></A
><P
><B
>A Note on Foreign Keys</B
></P
><P
>	    

	    

	    In most relational databases tables contain fields which
	    are foreign keys into other tables. In our 'book' database
	    example the authorid in the book table is a foreign key
	    into the author table. When we present a form to the end
	    user we do not usually want the foreign key itself to be
	    visible but rather the text associated with it. Thus, we
	    would want the author's name to appear rather than the
	    author id when we show book information.  In many
	    databases, this can be achieved by using a view.  See your
	    database's documentation for details.
	    </P
></DIV
></TD
></TR
></TABLE
></DIV
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="INSERTING-RECORDS-IN-QDATATABLES"
>Inserting Records in 
<TT
CLASS="CLASSNAME"
>QDataTable</TT
>s</A
></H2
><P
>	

	

	Record insertion into a relational database usually requires
	the generation of a primary key value which uniquely
	identifies the record in the table. Also we often want to
	create default values for some fields to minimize the user's
	work. We will create a slot to capture the 
<TT
CLASS="CLASSNAME"
>QDataTable</TT
>s
	
<TT
CLASS="FUNCTION"
>primeInsert()</TT
> signal and populate the
	
<TT
CLASS="CLASSNAME"
>QSqlRecord</TT
> insertion buffer with a unique
	primary key.

	<P
></P
><OL
TYPE="1"
><LI
><P
>		Click 
<SPAN
CLASS="GUIMENUITEM"
>Edit|Slots</SPAN
> to invoke the 
		
Edit Slots dialog. Click 
<SPAN
CLASS="GUIMENUITEM"
>New Slot</SPAN
>, then enter
		the slot name <TT
CLASS="FUNCTION"
>primeInsertAuthor(QSqlRecord*)</TT
>
		into the Slot Properties' Slot line edit box. Click
		<SPAN
CLASS="GUIBUTTON"
>OK</SPAN
>.
		</P
></LI
><LI
><P
>		Click the 

<SPAN
CLASS="GUIBUTTON"
>Connect Signals/Slots</SPAN
>
		toolbar button, then click the AuthorDataTable, drag to
		the form and release the mouse. The 
Edit Connections
		dialog will now appear. Click the 
<TT
CLASS="FUNCTION"
>primeInsert()</TT
>
		signal and then the <TT
CLASS="FUNCTION"
>primeInsertAuthor()</TT
> slot to make
		the connection. Now click <SPAN
CLASS="GUIBUTTON"
>OK</SPAN
>.
		</P
></LI
><LI
><P
>		Click the Source tab of the Object Hierarchy window
		(click 
<SPAN
CLASS="GUIMENUITEM"
>Window|Object Hierarchy</SPAN
> to make
		the window visible if necessary). Click the
		<TT
CLASS="FUNCTION"
>primeInsertAuthor()</TT
> slot and an editor window will
		appear.
		</P
></LI
><LI
><P
>		We must change the <TT
CLASS="FUNCTION"
>BookForm::primeInsertAuthor()</TT
> slot to
		specify the parameter name and perform the necessary
		action:
<TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="90%"
><TR
><TD
><PRE
CLASS="PROGRAMLISTING"
>void primeInsertAuthor( <I
CLASS="EMPHASIS"
>QSqlRecord</I
> * buffer )
{
    <I
CLASS="EMPHASIS"
>QSqlQuery</I
> query;
    query.exec( &quot;UPDATE sequence SET sequence = sequence + 1 WHERE tablename='author';&quot; );
    query.exec( &quot;SELECT sequence FROM sequence WHERE tablename='author';&quot; );
    if ( query.next() ) {
        buffer-&gt;setValue( &quot;id&quot;, query.value( 0 ) );
    }
}</PRE
></TD
></TR
></TABLE
>
		A 
<TT
CLASS="CLASSNAME"
>QSqlQuery</TT
> object is used to increment and
		retrieve a unique 'sequence' number for the author
		table. The signal passed us a pointer to the insertion
		buffer and we then put the value we've retrieved,
		i.e. the next sequence number, into the buffer's id
		field.  (Again, note that SQL databases often support
		a native 'sequence' function.  The method used here is
		inappropriate for production systems, and is for
		example purposes only.  See your database's
		documentation for details on how to generate unique
		keys in code.  In many cases, the database can
		generate them automatically, or the database may
		provide a special syntax for dealing with sequences.)
		</P
></LI
></OL
>
	</P
><P
>	

	

	

	

	If we rebuild the application it will now support <TT
CLASS="LITERAL"
>INSERT</TT
> as well as
	<TT
CLASS="LITERAL"
>UPDATE</TT
> and <TT
CLASS="LITERAL"
>DELETE</TT
>. We could easily have added additional code to
	insert default values, e.g. today's date into a date field, if
	necessary.
	</P
><P
>	

	

	

	Browsing is
	supported by clicking records and by using the arrow keys. Once
	a record is active (highlighted) we can edit the it. Press
	the 
<B
CLASS="KEYCAP"
>Insert</B
> key to <TT
CLASS="LITERAL"
>INSERT</TT
> a new record;
	press 
<B
CLASS="KEYCAP"
>F2</B
> to <TT
CLASS="LITERAL"
>UPDATE</TT
> the current record;
	press the 
<B
CLASS="KEYCAP"
>Del</B
> key to <TT
CLASS="LITERAL"
>DELETE</TT
> the
	current record. All these operations take place 
	immediately. Users can be given the opportunity to confirm
	their edits by setting the 
<TT
CLASS="CLASSNAME"
>QDataTable</TT
>'s confirmEdits
	property to True. If the confirmEdits property is True then user
	confirmation will be required for all insertions, updates and
	deletes. For finer control you can set the confirmInsert,
	confirmUpdate and confirmDelete properties individually.
	</P
><TABLE
CLASS="SIDEBAR"
BORDER="1"
CELLPADDING="5"
><TR
><TD
><DIV
CLASS="SIDEBAR"
><A
NAME="AEN4874"
></A
><P
><B
>&#13;<TT
CLASS="CLASSNAME"
>QDataTable</TT
> User Interface Interaction</B
></P
><P
>	

	

	The default user-interface behaviour for 
<TT
CLASS="CLASSNAME"
>QDataTable</TT
>s is as follows:
	    <P
></P
><UL
><LI
><P
>		Users can move to records by clicking the scrollbar and
		clicking records with the mouse. They can also use the
		keyboard's navigation keys, e.g. 
<B
CLASS="KEYCAP"
>Left Arrow</B
>, 
		
<B
CLASS="KEYCAP"
>Right Arrow</B
>, 
<B
CLASS="KEYCAP"
>Up Arrow</B
>, 
<B
CLASS="KEYCAP"
>Down Arrow</B
>,
		
<B
CLASS="KEYCAP"
>Page Up</B
>, 
<B
CLASS="KEYCAP"
>Page Down</B
>, 
<B
CLASS="KEYCAP"
>Home</B
> and 
<B
CLASS="KEYCAP"
>End</B
>.
		</P
></LI
><LI
><P
>		<TT
CLASS="LITERAL"
>INSERT</TT
> is initiated by right-clicking the record and
		clicking Insert or by pressing the 
<B
CLASS="KEYCAP"
>Ins</B
> (Insert)
		key. The user moves between fields using 
<B
CLASS="KEYCAP"
>Tab</B
> and
		
<B
CLASS="KEYCAP"
>Shift+Tab</B
>. The <TT
CLASS="LITERAL"
>INSERT</TT
> will take place if the user
		presses 
<B
CLASS="KEYCAP"
>Enter</B
> or 
<B
CLASS="KEYCAP"
>Tab</B
>s
		off the last field. If autoEdit is TRUE the
		insert will take place if the user navigates to another
		record. <TT
CLASS="LITERAL"
>INSERT</TT
> is cancelled by pressing 
<B
CLASS="KEYCAP"
>Esc</B
> (Escape). If
		autoEdit is FALSE navigating to another record also
		cancels the <TT
CLASS="LITERAL"
>INSERT</TT
>. Setting confirmInsert to TRUE will
		require the user to confirm each <TT
CLASS="LITERAL"
>INSERT</TT
>.
		</P
></LI
><LI
><P
>		<TT
CLASS="LITERAL"
>UPDATE</TT
> is initiated by right-clicking the record and clicking
		Update or by pressing 
<B
CLASS="KEYCAP"
>F2</B
>. The update will take place if
		the user presses Enter or Tabs off the last
		field. If autoEdit is TRUE the update will take place if
		the user navigates to another record. <TT
CLASS="LITERAL"
>UPDATE</TT
> is cancelled
		by pressing 
<B
CLASS="KEYCAP"
>Esc</B
>. If autoEdit is FALSE
		navigating to another record also cancels the <TT
CLASS="LITERAL"
>UPDATE</TT
>.
		Setting confirmUpdate to TRUE will require the user to
		confirm each <TT
CLASS="LITERAL"
>UPDATE</TT
>.
		</P
></LI
><LI
><P
>		<TT
CLASS="LITERAL"
>DELETE</TT
> is achieved by right-clicking the record and
		clicking Delete or by pressing the 
<B
CLASS="KEYCAP"
>Del</B
> (Delete) key.
		Setting confirmDelete to TRUE will require the user to
		confirm each <TT
CLASS="LITERAL"
>DELETE</TT
>.
		</P
></LI
></UL
>

	    You can change this default behaviour programmatically if
	    required.
	</P
></DIV
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="RELATING-TWO-TABLES-TOGETHER"
>Relating Two Tables Together (Master-Detail)</A
></H2
><P
>	

	

	Databases often have pairs of tables that are related. For
	example, an invoice table might list the numbers, dates and
	customers for invoices, but not the actual invoice items, which
	an invoice item table might store. In the 'book' application we
	wish to have a 
<TT
CLASS="CLASSNAME"
>QDataTable</TT
> that we can use to browse
	through the authors table and a second 
<TT
CLASS="CLASSNAME"
>QDataTable</TT
> to
	show the books they've written.
	</P
><P
>	Open the book project if it isn't already open <I
CLASS="EMPHASIS"
>Qt Designer</I
>. We will
	modify this project to show two 
<TT
CLASS="CLASSNAME"
>QDataTable</TT
>s that
	relate the author table to the book table.

	<P
></P
><OL
TYPE="1"
><LI
><P
>		Click the author 
<TT
CLASS="CLASSNAME"
>QDataTable</TT
> and then click the
		

<SPAN
CLASS="GUIBUTTON"
>Break Layout</SPAN
> toolbutton.
		</P
></LI
><LI
><P
>		Resize the 
<TT
CLASS="CLASSNAME"
>QDataTable</TT
> so that it only
		occupies the top half of the form.
		</P
></LI
><LI
><P
>		Now click on the 
<TT
CLASS="CLASSNAME"
>QDataTable</TT
> toolbutton and click
		on the bottom half of the form. The SQL Table Wizard
		will appear. (This Wizard is explained in <A
HREF="using-qdatatable.html#QUICKLY-VIEWING-A-DATABASE-TABLE"
>the section called <I
>Quickly Viewing a Database Table</I
></A
> "Quickly
		Viewing a Database Table".)
		<P
></P
><OL
TYPE="1"
><LI
><P
>			Click the connection you're using and click
			the book table. Click the <SPAN
CLASS="GUIBUTTON"
>Next</SPAN
>
			button.
			</P
></LI
><LI
><P
>			Since we do not want them visible, make sure
			the authorid and id fields are moved to the
			Available Fields list box by using the arrow
			buttons. Move the title field to the top of
			the Displayed Fields, and move the price field
			above the notes field.  Click the
			<SPAN
CLASS="GUIBUTTON"
>Next</SPAN
> button.
			</P
></LI
><LI
><P
>			On the Table Properties page click the Read Only
			checkbox then click the <SPAN
CLASS="GUIBUTTON"
>Next</SPAN
>
			button.
			</P
></LI
><LI
><P
>			On the SQL page we will leave the Filter
			(<TT
CLASS="LITERAL"
>WHERE</TT
> clause) empty. Move the
			title field to the Sort By list box and click
			<SPAN
CLASS="GUIBUTTON"
>Next</SPAN
>. Now click <SPAN
CLASS="GUIBUTTON"
>Finish</SPAN
>.
			</P
></LI
><LI
><P
>			Change this 
<TT
CLASS="CLASSNAME"
>QDataTable</TT
>'s name to "BookDataTable".
			</P
></LI
></OL
>
		</P
></LI
><LI
><P
>		
<B
CLASS="KEYCAP"
>Shift+Click</B
> the top 
<TT
CLASS="CLASSNAME"
>QDataTable</TT
> so that both
		
<TT
CLASS="CLASSNAME"
>QDataTable</TT
>s are selected and then click the
		

<SPAN
CLASS="GUIBUTTON"
>Lay Out Vertically (in Splitter)</SPAN
> toolbar
		button.
		</P
></LI
><LI
><P
>		Click on the form and click the 
		

<SPAN
CLASS="GUIBUTTON"
>Lay Out Vertically</SPAN
> toolbar button.
		</P
></LI
></OL
>
	</P
><P
>	Run the form by clicking 
<SPAN
CLASS="GUIMENUITEM"
>Preview|Preview Form</SPAN
>.
	All the authors are displayed in the top 
<TT
CLASS="CLASSNAME"
>QDataTable</TT
>
	and all the books are displayed in the bottom
	
<TT
CLASS="CLASSNAME"
>QDataTable</TT
>. However we only want the books of the
	currently selected author showing in the bottom
	
<TT
CLASS="CLASSNAME"
>QDataTable</TT
>. We will deal with this by filtering the
	records in the book table according to the author selected in
	the author table.
	</P
><TABLE
CLASS="SIDEBAR"
BORDER="1"
CELLPADDING="5"
><TR
><TD
><DIV
CLASS="SIDEBAR"
><A
NAME="AEN5081"
></A
><P
><B
>Using the Table Editor</B
></P
><P
>	

	<DIV
CLASS="FIGURE"
><A
NAME="AEN5087"
></A
><P
><B
>Figure 6-3. Edit Table Dialog</B
></P
><P
><IMG
SRC="images\edit-dbtable-dialog.png"></P
></DIV
>
	
<TT
CLASS="CLASSNAME"
>QDataTable</TT
>s are created and set up using the SQL Table
	Wizard. Like any other <I
CLASS="EMPHASIS"
>Qt Designer</I
> widget their properties may be
	changed in the Properties window. Some of the column and row
	based properties can also be be changed using the 
Edit Table
	dialog. This dialog is invoked by right clicking the
	
<TT
CLASS="CLASSNAME"
>QDataTable</TT
> and left clicking the 
<SPAN
CLASS="GUIMENUITEM"
>Edit</SPAN
> menu item.
	The right hand half of the 
Edit Table dialog is where we choose
	the fields we wish to display, their order and their labels. The
	procedure for creating columns is as follows:

	<P
></P
><OL
TYPE="1"
><LI
><P
>		Click the <SPAN
CLASS="GUIBUTTON"
>New Column</SPAN
> button.
		</P
></LI
><LI
><P
>		Drop down the Field combobox to list the available
		fields.
		</P
></LI
><LI
><P
>		Click the field you wish to include at this point.
		</P
></LI
><LI
><P
>		<I
CLASS="EMPHASIS"
>Optionally</I
> edit the Label if the default
		isn't appropriate.
	    </P
></LI
><LI
><P
>	    <I
CLASS="EMPHASIS"
>Optionally</I
> click the Pixmap ellipsis
	    (<SPAN
CLASS="GUIBUTTON"
>...</SPAN
>) button to choose a pixmap to be
	    displayed to the left of the column's label.
	    </P
></LI
></OL
>

	Repeat the steps listed above for each column you wish to add.
	Once all the fields have been added you can change their
	ordering by using the blue up and down arrow buttons. At any
	point you can press <SPAN
CLASS="GUIBUTTON"
>Apply</SPAN
> to see how the table
	will look. Finally click the <SPAN
CLASS="GUIBUTTON"
>OK</SPAN
> button to save the
	properties you have set. You can always return to the table
	editor to change these settings later.
	</P
></DIV
></TD
></TR
></TABLE
><DIV
CLASS="SECT3"
><H3
CLASS="SECT3"
><A
NAME="FILTERING-ONE-QDATATABLE-BY-ANOTHER"
>Filtering One 
<TT
CLASS="CLASSNAME"
>QDataTable</TT
> by Another</A
></H3
><P
>	    

	    To filter the book table's records we need to capture the author
	    
<TT
CLASS="CLASSNAME"
>QDataTable</TT
>'s 
<TT
CLASS="FUNCTION"
>currentChanged()</TT
> signal and change the
	    BookDataTable's filter accordingly.

	    <P
></P
><OL
TYPE="1"
><LI
><P
>		    Click 
<SPAN
CLASS="GUIMENUITEM"
>Edit|Slots</SPAN
>. In the 
Edit Slots
		    dialog click 
<SPAN
CLASS="GUIMENUITEM"
>New Slot</SPAN
> and enter a slot
		    name of <TT
CLASS="FUNCTION"
>newCurrentAuthor(QSqlRecord*)</TT
>.
		    Click <SPAN
CLASS="GUIBUTTON"
>OK</SPAN
>.
		    </P
></LI
><LI
><P
>		    Click 
<SPAN
CLASS="GUIMENUITEM"
>Connect Signals/Slots</SPAN
>, then click
		    the AuthorDataTable 
<TT
CLASS="CLASSNAME"
>QDataTable</TT
> and drag to
		    the form; release the mouse on the form. The 
		    
Edit Connections dialog will appear. Click the
		    
<TT
CLASS="FUNCTION"
>currentChanged()</TT
> signal and the
		    <TT
CLASS="FUNCTION"
>newCurrentAuthor</TT
> slot. Click <SPAN
CLASS="GUIBUTTON"
>OK</SPAN
>.
		    </P
></LI
><LI
><P
>		    Click the Source tab of the Object Hierarchy window
		    (click 
<SPAN
CLASS="GUIMENUITEM"
>Window|Object Hierarchy</SPAN
> to make
		    the window visible if necessary). Click the
		    <TT
CLASS="FUNCTION"
>newCurrentAuthor()</TT
> slot and an editor window will
		    appear.
		    </P
></LI
><LI
><P
>		    We must change the <TT
CLASS="FUNCTION"
>BookForm::newCurrentAuthor()</TT
> slot to
		    specify the parameter name and perform the necessary
		    action:
<TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="90%"
><TR
><TD
><PRE
CLASS="PROGRAMLISTING"
>void newCurrentAuthor( <I
CLASS="EMPHASIS"
>QSqlRecord</I
> *author )
{
    BookDataTable-&gt;setFilter( &quot;authorid=&quot; + author-&gt;value( &quot;id&quot; ).toString() );  
    BookDataTable-&gt;refresh();
}</PRE
></TD
></TR
></TABLE
>
		All that's required now is to change the BookDataTable's
		filter and refresh the 
<TT
CLASS="CLASSNAME"
>QDataTable</TT
> to show the
		results of the filter.
		</P
></LI
></OL
>
	    </P
></DIV
><DIV
CLASS="SECT3"
><H3
CLASS="SECT3"
><A
NAME="PREPARING-THE-INTERFACE-FOR-DRILLDOWN"
>Preparing the Interface for Drilldown</A
></H3
><P
>	    

	    

	    We can now browse and edit authors and see their books in the
	    BookDataTable.  In the next section we explore
	    
<TT
CLASS="CLASSNAME"
>QDataBrowser</TT
>, which will allow us to drill down to
	    a dialog through which we can edit books. For now we will
	    add some buttons to the main BookForm which we will use to
	    invoke the book editing dialog.

	    <P
></P
><OL
TYPE="1"
><LI
><P
>		    Click the form, then click the 
		    

<SPAN
CLASS="GUIBUTTON"
>Break Layout</SPAN
> toolbar button. Resize the form
		    to make room for some buttons at the bottom.
		    </P
></LI
><LI
><P
>		    Add two buttons to the bottom of the form. Change
		    their names and labels to the following:

		    <P
></P
><UL
><LI
><P
>EditPushButton -- &amp;Edit Books</P
></LI
><LI
><P
>QuitPushButton -- &amp;Quit</P
></LI
></UL
>
		    Hold down the Shift key and Click both buttons (i.e.
		    
<B
CLASS="KEYCAP"
>Shift+Click</B
> the buttons) and click the
		    

<SPAN
CLASS="GUIBUTTON"
>Lay Out Horizontally</SPAN
> toolbar button.
		    Click the form and click the 
		    

<SPAN
CLASS="GUIBUTTON"
>Lay Out Vertically</SPAN
> toolbar
		    button.
		    </P
></LI
><LI
><P
>		    We will provide the Quit button with functionality
		    now and work on the rest shortly.
		    Click 
<SPAN
CLASS="GUIMENUITEM"
>Connect Signals/Slots</SPAN
>, then click
		    the Quit button and drag to the form; release the
		    mouse on the form. The 
Edit Connections dialog will
		    appear. Click the 
<TT
CLASS="FUNCTION"
>clicked()</TT
> signal
		    and the 
<TT
CLASS="FUNCTION"
>accept()</TT
> slot. Click <SPAN
CLASS="GUIBUTTON"
>OK</SPAN
>.
		    </P
></LI
></OL
>
	    </P
></DIV
></DIV
></DIV
><DIV
CLASS="NAVFOOTER"
><HR
ALIGN="LEFT"
WIDTH="100%"><TABLE
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
><A
HREF="creating-database-applications.html"
>Prev</A
></TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
><A
HREF="book1.html"
>Home</A
></TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
><A
HREF="using-qdatabrowser-and-qdataview.html"
>Next</A
></TD
></TR
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
>Creating Database Applications</TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
><A
HREF="creating-database-applications.html"
>Up</A
></TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
>Using 
<TT
CLASS="CLASSNAME"
>QDataBrowser</TT
> and 
<TT
CLASS="CLASSNAME"
>QDataView</TT
></TD
></TR
></TABLE
></DIV
></BODY
></HTML
>