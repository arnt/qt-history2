<HTML
><HEAD
><TITLE
>Integrating Qt Designer with Visual Studio </TITLE
><META
NAME="GENERATOR"
CONTENT="Modular DocBook HTML Stylesheet Version 1.57"><LINK
REL="HOME"
HREF="book1.html"><LINK
REL="UP"
TITLE="Customizing and Integrating Qt Designer"
HREF="c5895.html"><LINK
REL="PREVIOUS"
TITLE="Creating and Using Templates "
HREF="creatingandusingtemplates.html"><LINK
REL="NEXT"
TITLE="Importing Foreign File Formats "
HREF="importingforeignfileformats.html"></HEAD
><BODY
CLASS="SECT1"
><DIV
CLASS="NAVHEADER"
><TABLE
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TH
COLSPAN="3"
ALIGN="center"
></TH
></TR
><TR
><TD
WIDTH="10%"
ALIGN="left"
VALIGN="bottom"
><A
HREF="creatingandusingtemplates.html"
>Prev</A
></TD
><TD
WIDTH="80%"
ALIGN="center"
VALIGN="bottom"
>Chapter 7. Customizing and Integrating Qt Designer</TD
><TD
WIDTH="10%"
ALIGN="right"
VALIGN="bottom"
><A
HREF="importingforeignfileformats.html"
>Next</A
></TD
></TR
></TABLE
><HR
ALIGN="LEFT"
WIDTH="100%"></DIV
><DIV
CLASS="SECT1"
><H1
CLASS="SECT1"
><A
NAME="INTEGRATINGQTDESIGNERWITHOTHERTOOLS"
>Integrating Qt Designer with Visual Studio</A
></H1
><P
><I
CLASS="EMPHASIS"
>Qt Designer</I
> can be integrated into Visual Studio using the

<TT
CLASS="FILENAME"
>qmsdev.dsp</TT
> file that is supplied with Qt.</P
><P
>&#13;
Start up Visual Studio and click <SPAN
CLASS="GUIMENUITEM"
>File|Open
Workspace</SPAN
>. Open
<TT
CLASS="FILENAME"
>%QTDIR%\tools\designer\integration\qmsdev\qmsdev.dsp</TT
>.
Click 
<SPAN
CLASS="GUIMENUITEM"
>Build|Set Active Configuration</SPAN
> and in
the list click 'QMsDev - Win32 Release', then click <SPAN
CLASS="GUIBUTTON"
>OK</SPAN
>. Now click

<SPAN
CLASS="GUIMENUITEM"
>Build|Build qmsdev.dll</SPAN
>. You should now copy
the file
<TT
CLASS="FILENAME"
>%QTDIR%\tools\designer\integration\qmsdev\Release\qmsdev.dll</TT
>
into 
<TT
CLASS="FILENAME"
>\Program Files\Microsoft Visual Studio\Common\MSDev98\AddIns</TT
>. 
Now click 
<SPAN
CLASS="GUIMENUITEM"
>Tools|Customize</SPAN
>. Click the Add-in Macro Files
tab, then click the <SPAN
CLASS="GUIBUTTON"
>Browse</SPAN
> button. Change the
file type to 'Add-ins (.dll)' and navigate to 
<TT
CLASS="FILENAME"
>\Program Files\Microsoft Visual Studio\Common\MSDev98\AddIns</TT
>. 
Click the 
<TT
CLASS="FILENAME"
>qmsdev.dll</TT
> file, click
<SPAN
CLASS="GUIBUTTON"
>Open</SPAN
>, then click <SPAN
CLASS="GUIBUTTON"
>Close</SPAN
>.</P
><P
>A new toolbar will appear in Visual Studio with the following toolbar
buttons:
<P
></P
><UL
><LI
><P
>New Qt Project -- A small application wizard</P
></LI
><LI
><P
>Generate Qt Project -- Runs 
<B
CLASS="COMMAND"
>qmake</B
> (or the functionally equivalent 
<B
CLASS="COMMAND"
>tmake</B
>) with a 
<TT
CLASS="FILENAME"
>.pro</TT
> file</P
></LI
><LI
><P
>New Qt Dialog -- Add an empty Qt Dialog to the active project</P
></LI
><LI
><P
>Qt GUI Designer -- Run <I
CLASS="EMPHASIS"
>Qt Designer</I
></P
></LI
><LI
><P
>Use Qt -- Add the Qt libraries to the active project</P
></LI
><LI
><P
>Add MOC -- Add the 
<B
CLASS="COMMAND"
>moc</B
> precompiler to the active file</P
></LI
><LI
><P
>Add UIC -- Add the 
<B
CLASS="COMMAND"
>uic</B
> precompiler to the active file</P
></LI
></UL
>
Double clicking a 
<TT
CLASS="FILENAME"
>.ui</TT
> file in the workspace
overview will now launch <I
CLASS="EMPHASIS"
>Qt Designer</I
>.</P
><P
>&#13;


If you create a 
<TT
CLASS="FILENAME"
>.cpp</TT
> file which contains the
<TT
CLASS="LITERAL"
>Q_OBJECT</TT
> macro you will need an additional file which
is generated by the 
<B
CLASS="COMMAND"
>moc</B
> to be included in your project. For
example, if you have 'file.cpp', then the last line would be
<TT
CLASS="LITERAL"
>#include "file.moc"</TT
> and the additional file would be
called 'file.moc'. To ensure that Visual Studio executes the 
<B
CLASS="COMMAND"
>moc</B
>
and generates this file you must create a custom dependency.
Double click the 
<TT
CLASS="FILENAME"
>.cpp</TT
> file (in your project
workspace) that contains the <TT
CLASS="LITERAL"
>Q_OBJECT</TT
> macro. Click
the <SPAN
CLASS="GUIBUTTON"
>Add MOC</SPAN
> toolbar button; this will create an
empty 
<TT
CLASS="FILENAME"
>.moc</TT
> file in your project workspace. Right
click the newly created 
<TT
CLASS="FILENAME"
>.moc</TT
> file, then click

<SPAN
CLASS="GUIMENUITEM"
>Settings</SPAN
> from the pop-up menu to invoke the

Project Settings dialog. Click the Custom Build tab. Click the
<SPAN
CLASS="GUIBUTTON"
>Dependencies</SPAN
> button to pop up the User Defined
Dependencies dialog. Type in
<TT
CLASS="LITERAL"
>$(InputDir)\$(InputPath)</TT
>, then press

<B
CLASS="KEYCAP"
>Return</B
>. Click <SPAN
CLASS="GUIBUTTON"
>OK</SPAN
> to leave the Dependencies dialog,
then click <SPAN
CLASS="GUIBUTTON"
>OK</SPAN
> to leave the Project Settings dialog.</P
><P
>If you wish to delete the add-in remove it from the toolbar then delete
the 
<TT
CLASS="FILENAME"
>qmsdev.dll</TT
> file from the add-ins directory. </P
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="CREATINGMAKEFILESWITHOUTQMAKE"
>Creating Makefiles without qmake</A
></H2
><P
>&#13;
The 
<B
CLASS="COMMAND"
>qmake</B
> tool provided with Qt can create Makefiles appropriate
to your platform based on 
<TT
CLASS="FILENAME"
>.pro</TT
> project files. This
section describes the dependencies involved in building a Qt application
and gives a couple of simple example Makefiles. This section assumes
that you have a good understanding of Makefiles.</P
><P
>&#13;


<I
CLASS="EMPHASIS"
>Qt Designer</I
> produces 
<TT
CLASS="FILENAME"
>.ui</TT
> files which are used to generate

<TT
CLASS="FILENAME"
>.h</TT
> and 
<TT
CLASS="FILENAME"
>.cpp</TT
> files for the
compiler to compile. The 
<TT
CLASS="FILENAME"
>.ui</TT
> files are processed by

<B
CLASS="COMMAND"
>uic</B
>. Classes which inherit from 
<TT
CLASS="CLASSNAME"
>QObject</TT
>,
e.g. those which use slots and signals, require an additional

<TT
CLASS="FILENAME"
>.cpp</TT
> file to be generated. These files are
generated by the 
<B
CLASS="COMMAND"
>moc</B
> and are named
'<I
CLASS="EMPHASIS"
>moc_</I
>file.cpp' where the original

<TT
CLASS="FILENAME"
>.cpp</TT
> file is called 'file.cpp'. If your

<TT
CLASS="FILENAME"
>.cpp</TT
> file contains the <TT
CLASS="LITERAL"
>Q_OBJECT</TT
>
macro an additional file 'file.moc' should be generated which must be
<TT
CLASS="LITERAL"
>#include</TT
>d in the 
<TT
CLASS="FILENAME"
>.cpp</TT
>, normally
at the end. This requires an extra
dependency being created.</P
><P
>Processing 
<TT
CLASS="FILENAME"
>.ui</TT
> files with 
<B
CLASS="COMMAND"
>uic</B
> is done
<I
CLASS="EMPHASIS"
>twice</I
>:
<TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="PROGRAMLISTING"
>uic myform.ui -o myform.h
uic myform.ui -i myform.h -o myform.cpp</PRE
></TD
></TR
></TABLE
>
The first execution creates the header file, the second creates the

<TT
CLASS="FILENAME"
>.cpp</TT
> file. If you wish to subclass a form you can
use 
<B
CLASS="COMMAND"
>uic</B
> to generate subclass skeletons:
<TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="PROGRAMLISTING"
>uic formbase.ui -o formbase.h
uic formbase.ui -i formbase.h -o formbase.cpp
uic -subdecl Form formbase.h formbase.ui -o form.h
uic -subimpl Form formbase.h formbase.ui -o form.cpp</PRE
></TD
></TR
></TABLE
>
First we generate the header and implementation file for our base class.
Then we generate the header and implementation skeletons for our subclass.
Note that the use of 
<B
CLASS="COMMAND"
>uic</B
> to generate skeletons is not something
that would be done in a Makefile, we mention it here because it can be
useful for command line users.</P
><P
>For implementation files that contain classes which inherit from

<TT
CLASS="CLASSNAME"
>QObject</TT
> we must create moc files:
<TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="PROGRAMLISTING"
>moc myform.h -o moc_myform.cpp</PRE
></TD
></TR
></TABLE
></P
><P
>We'll look at a simple Makefile to see the dependencies in practice.
<TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="PROGRAMLISTING"
>myapp: moc_myform.o myform.o main.o
        g++ -lqt -o myapp moc_myform.o myform.o main.o

main.o: main.cpp
        g++ -o main.o main.cpp

moc_myform.o: moc_myform.cpp
        g++ -o moc_myform.o moc_myform.cpp

moc_myform.cpp: myform.h
        moc myform.h -o moc_myform.cpp

myform.o: myform.cpp
        g++ -o myform.o myform.cpp

myform.cpp: myform.h myform.ui
        uic myform.ui -i myform.h -o myform.cpp

myform.h: myform.ui
        uic myform.ui -o myform.h</PRE
></TD
></TR
></TABLE
>
Note that you may need to include the full path to the commands in your
Makefile, and under Windows the filenames are 
<TT
CLASS="FILENAME"
>moc.exe</TT
> and 
<TT
CLASS="FILENAME"
>uic.exe</TT
>.</P
><P
>In Unix/Linux environments the 
<B
CLASS="COMMAND"
>make</B
> command may be able to
do more for us, so we should be able to use a simpler Makefile like
this:
<TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="PROGRAMLISTING"
>myapp: moc_myform.o myform.o main.o
        g++ -lq -o $@ $^

%.o: %.cpp
        g++ -o $^ $@

moc_%.cpp: %.h
        moc $^ -o $@

myform.cpp: myform.h myform.ui
        uic myform.ui -i myform.h -o myform.cpp

myform.h: myform.ui
        uic myform.ui -o myform.h</PRE
></TD
></TR
></TABLE
>
To see more sophisticated Makefiles simply generate them using

<B
CLASS="COMMAND"
>qmake</B
> on any of your Qt projects or any of the examples supplied
with Qt.</P
></DIV
></DIV
><DIV
CLASS="NAVFOOTER"
><HR
ALIGN="LEFT"
WIDTH="100%"><TABLE
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
><A
HREF="creatingandusingtemplates.html"
>Prev</A
></TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
><A
HREF="book1.html"
>Home</A
></TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
><A
HREF="importingforeignfileformats.html"
>Next</A
></TD
></TR
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
>Creating and Using Templates</TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
><A
HREF="c5895.html"
>Up</A
></TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
>Importing Foreign File Formats</TD
></TR
></TABLE
></DIV
></BODY
></HTML
>