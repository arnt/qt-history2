<HTML
><HEAD
><TITLE
>Integrating Qt GUI Designer Files Into Your Project</TITLE
><META
NAME="GENERATOR"
CONTENT="Modular DocBook HTML Stylesheet Version 1.52"><LINK
REL="HOME"
HREF="book1.html"><LINK
REL="UP"
TITLE="Useful Techniques"
HREF="c645.html"><LINK
REL="PREVIOUS"
TITLE="All About Layout Management"
HREF="qt-designer-sec-layoutmanagement.html"><LINK
REL="NEXT"
TITLE="Accessing The Help System"
HREF="x851.html"></HEAD
><BODY
CLASS="SECT1"
><DIV
CLASS="NAVHEADER"
><TABLE
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TH
COLSPAN="3"
ALIGN="center"
></TH
></TR
><TR
><TD
WIDTH="10%"
ALIGN="left"
VALIGN="bottom"
><A
HREF="qt-designer-sec-layoutmanagement.html"
>Prev</A
></TD
><TD
WIDTH="80%"
ALIGN="center"
VALIGN="bottom"
>Chapter 5. Useful Techniques</TD
><TD
WIDTH="10%"
ALIGN="right"
VALIGN="bottom"
><A
HREF="x851.html"
>Next</A
></TD
></TR
></TABLE
><HR
ALIGN="LEFT"
WIDTH="100%"></DIV
><DIV
CLASS="SECT1"
><H1
CLASS="SECT1"
><A
NAME="AEN778"
>Integrating Qt GUI Designer Files Into Your Project</A
></H1
><P
>Creating forms with Qt GUI Designer is of course
only have way to your application, you have to integrate the created
forms in your application somehow, and not only in your application,
it should be integrated into your automatic build process.</P
><P
>To start discussing how you can achieve this, let's
review the steps to create a form with Qt GUI Designer:</P
><P
></P
><UL
><LI
><P
>Design the form interactively in Qt GUI Designer.</P
></LI
><LI
><P
>Save the form as an XML <TT
CLASS="FILENAME"
>ui</TT
>
file.</P
></LI
><LI
><P
>Run <B
CLASS="COMMAND"
>uic</B
> twice from the
command-line over the <TT
CLASS="FILENAME"
>ui</TT
> file to generate the
header and implementation file.</P
></LI
><LI
><P
>If necessary (which is usually the case), create a
subclass of the generated class and implement the dialog functionality
there. You can use <B
CLASS="COMMAND"
>uic</B
> to create a skeleton for
this class.</P
></LI
><LI
><P
>Compile the generated source file as well as the
implementation file of the subclass and all other files belonging to
the application.</P
></LI
><LI
><P
>Run <B
CLASS="COMMAND"
>moc</B
> on the generated header
file and the subclass header file.</P
></LI
><LI
><P
>Compile the <B
CLASS="COMMAND"
>moc</B
>-generated
files.</P
></LI
><LI
><P
>Link all object files together.</P
></LI
></UL
><P
>As you can see, there is quite a number of steps
involved. From the command-line, these could be the steps needed once
you have saved the <TT
CLASS="FILENAME"
>ui</TT
> file, let's call it
<TT
CLASS="FILENAME"
>myform.ui</TT
>, in Qt GUI Designer:</P
><TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
>uic -o myform.h myform.ui # generate header file
uic -o myform.cpp -impl myform.h myform.ui # generate implementation file
uic -o myformimpl.h -subdecl MyFormImpl myform.h myform.ui # generate subclass header file
uic -o myformimpl.cpp -subimpl MyFormImpl myformimpl.h myform.ui # generate subclass implementation file
edit myformimpl.h # edit subclass header file
edit myformimpl.cpp # edit subclass implementation file
moc -o moc_myform.cpp myform.h # generate moc code for base class
moc -o moc_myformimpl.cpp myformimpl.h # generate moc code for subclass
c++ -c myform.cpp -I$(QTDIR)/include # compile base class, use similar command on Windows
c++ -c moc_myform.cpp -I$(QTDIR)/include # compile base class moc code, use similar command on Windows
c++ -c myformimpl.cpp -I$(QTDIR)/include # compile subclass, use similar command on Windows
c++ -c moc_myformimpl.cpp -I$(QTDIR)/include # compile subclass moc code, use similar command on Windows
c++ -o myform myform.o moc_myform.o myformimpl.o moc_myformimpl.o -L$(QTDIR)/lib -lqt # link everything together, use similar command on Windows</PRE
></TD
></TR
></TABLE
><P
>But this is not enough. If you need to change anything
in your dialog design, you go back to Qt GUI Designer, make your changes
interactively, save the <TT
CLASS="FILENAME"
>ui</TT
> file again and go
through most of the above steps again. All this cries for automation,
but before you will learn how to automate these steps, we need to talk
a bit about the generation of subclass files.</P
><P
>For two reasons, the generation of subclass files falls
a bit out of the ordinary build process: First, you are required to
edit the generated files as hinted at above; if you do not change
these files and do not add your own implementation of certain methods,
there is no point in having a subclass at all.</P
><P
>Second, and this is consequence of the first point, you
do not regenerate them over and over again after changes as you do
with the other files. This is because you add changes to these files
by hand, and if you overwrote the files, your changes would be
lost.</P
><P
>By consequence, you usually only use
<B
CLASS="COMMAND"
>uic</B
> only once per form with the options
<TT
CLASS="LITERAL"
>&#8211;subdecl</TT
> and
<TT
CLASS="LITERAL"
>&#8211;subimpl</TT
>. </P
><P
>If you later add a new slot with Qt GUI Designer, you cannot
easily use <B
CLASS="COMMAND"
>uic</B
> to add this slot to the subclass,
because your changes would be overwritten. Of course, you can always
copy your changed versions of the files to files with different names,
let <B
CLASS="COMMAND"
>uic</B
> generate the new skeletons and copy your
changes manually back (e.g., in an editor), but this is usually more
work and trouble than just adding the individiual slots by hand.</P
><P
>But even after ruling out these steps from the ordinary
build process, there is an awful lot of steps left. How you integrate
these into your build process, depends of course a lot on how your
build process is organized, which tools you use, etc. If you use
hand-written makefiles (a solution we do not recommend) and your
project is very small, you could just add the build steps by hand. For
the aforementioned project, this could look like this in Unix make
syntax (Windows make syntax will differ slightly, but not much):</P
><TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
>all:
	myform

myform: myform.o moc_myform.o myformimpl.o moc_myformimpl.o
	c++ -o $@ $+ -L$(QTDIR)/lib -lqt

myform.o:	myform.cpp myform.h
	c++ -c $$&#60; -I$(QTDIR)/include

myformimpl.o: myformimpl.cpp myformimpl.h myform.h
	c++ -c $$&#60; -I$(QTDIR)/include

moc_myform.o: moc_myform.cpp myform.h
	c++ -c $$&#60; -I$(QTDIR)/include

moc_myformimpl.o: moc_myformimpl.cpp myformimpl.h myform.h
	c++ -c $$&#60; -I$(QTDIR)/include

moc_myform.cpp: myform.h
	moc -o $@ $&#60;

moc_myformimpl.cpp: myformimpl.h
	moc -o $@ $&#60;

myform.h: myform.ui
	uic -o $@ $&#60;

myform.cpp: myform.ui myform.h
	uic -o $@ -impl myform.h $&#60;</PRE
></TD
></TR
></TABLE
><P
>Note that there is no rule here for generating
<TT
CLASS="FILENAME"
>myformimpl.cpp</TT
> and
<TT
CLASS="FILENAME"
>myformimpl.h</TT
>, as mentioned above, you generate
them once by hand from the command-line and then edit them with your
text editor without regenerating them.</P
><P
>Of course, the above makefile with every relation
explicitly spelled out does not hold for anything but the smallest
project. You can achieve a little bit more generality by using suffix
rules as in:</P
><TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
># clear SUFFIXES list
.SUFFIXES:
# define SUFFIXES
.SUFFIXES: .h .cpp .ui

# create a .h file from a .ui file
.h.ui:; uic -o $@ $&#60;

# create a .cpp file from a .ui file
.cpp.ui:; uic -o $@ -impl $*.h $&#60;</PRE
></TD
></TR
></TABLE
><P
>But depending on your project, this might not be enough
sophistication.</P
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN828"
>Using Tmake For Generating And Building GUI Designer Files</A
></H2
><P
>We heartily recommend that you use a good system for
automatically generating makefiles from a project description. There
are several such systems available for both Unix and Windows, but for
projects involving Qt and the Qt GUI Designer, we suggest you give
<I
CLASS="FIRSTTERM"
>tmake</I
> a try.</P
><P
><B
CLASS="COMMAND"
>tmake</B
> is free software that can be
downloaded free of charge from
<TT
CLASS="FILENAME"
>ftp://ftp.trolltech.com/pub/freebies/tmake/</TT
>. Just
make sure that you get version 1.5 or higher. On Unix systems,
<B
CLASS="COMMAND"
>tmake</B
> requires Perl to be installed, which is
usually the case these days.</P
><P
>If you do not know <B
CLASS="COMMAND"
>tmake</B
> yet, we
suggest that you start reading the included documentation;
<B
CLASS="COMMAND"
>tmake</B
> is really easy to use. We will only cover
<B
CLASS="COMMAND"
>tmake</B
>'s special features for use with the Qt
GUI Designer here.</P
><P
>Actually, once you know how to use
<B
CLASS="COMMAND"
>tmake</B
> for ordinary Qt projects, using it for
projects that involve Qt GUI Designer files is surprisingly easy. All you
need to do is list your <TT
CLASS="FILENAME"
>ui</TT
> files in the new
<TT
CLASS="LITERAL"
>INTERFACES</TT
> tag in your <B
CLASS="COMMAND"
>tmake</B
>
project file. For the aforementioned project, this could be enough:</P
><TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
>INTERFACES = myform.ui</PRE
></TD
></TR
></TABLE
><P
>When you then generate the makefile from the
<B
CLASS="COMMAND"
>tmake</B
> project file, it will contain all the clauses
mentioned above. The only thing you need to make sure is that
<B
CLASS="COMMAND"
>uic</B
> is in your path just like
<B
CLASS="COMMAND"
>moc</B
> and your C++ compiler are.</P
><P
>Again, this method does not do anything with generated
and edited subclass files, like above, you just generate them by hand
and then edit them as if they were ordinary source resp. header files
(what they in fact are).</P
></DIV
></DIV
><DIV
CLASS="NAVFOOTER"
><HR
ALIGN="LEFT"
WIDTH="100%"><TABLE
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
><A
HREF="qt-designer-sec-layoutmanagement.html"
>Prev</A
></TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
><A
HREF="book1.html"
>Home</A
></TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
><A
HREF="x851.html"
>Next</A
></TD
></TR
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
>All About Layout Management</TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
><A
HREF="c645.html"
>Up</A
></TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
>Accessing The Help System</TD
></TR
></TABLE
></DIV
></BODY
></HTML
>