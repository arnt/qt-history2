<HTML
><HEAD
><TITLE
>Subclassing and Dynamic Dialogs</TITLE
><META
NAME="GENERATOR"
CONTENT="Modular DocBook HTML Stylesheet Version 1.57"><LINK
REL="HOME"
HREF="book1.html"><LINK
REL="PREVIOUS"
TITLE="IconView "
HREF="iconview.html"><LINK
REL="NEXT"
TITLE="Creating Dynamic Dialogs from .ui Files "
HREF="creatingdynamicdialogsfromuifiles.html"></HEAD
><BODY
CLASS="CHAPTER"
><DIV
CLASS="NAVHEADER"
><TABLE
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TH
COLSPAN="3"
ALIGN="center"
></TH
></TR
><TR
><TD
WIDTH="10%"
ALIGN="left"
VALIGN="bottom"
><A
HREF="iconview.html"
>Prev</A
></TD
><TD
WIDTH="80%"
ALIGN="center"
VALIGN="bottom"
></TD
><TD
WIDTH="10%"
ALIGN="right"
VALIGN="bottom"
><A
HREF="creatingdynamicdialogsfromuifiles.html"
>Next</A
></TD
></TR
></TABLE
><HR
ALIGN="LEFT"
WIDTH="100%"></DIV
><DIV
CLASS="CHAPTER"
><H1
><A
NAME="AEN2698"
>Chapter 4. Subclassing and Dynamic Dialogs</A
></H1
><DIV
CLASS="TOC"
><DL
><DT
><B
>Table of Contents</B
></DT
><DT
><A
HREF="c2698.html#SUBCLASSING"
>Subclassing</A
></DT
><DT
><A
HREF="creatingdynamicdialogsfromuifiles.html"
>Creating Dynamic Dialogs from .ui Files</A
></DT
></DL
></DIV
><P
>&#13;




This chapter describes two different approaches that you can take to
creating forms with <I
CLASS="EMPHASIS"
>Qt Designer</I
>. Subclassing is used to extend the functionality
of a form by creating your own class based upon a form you create in
<I
CLASS="EMPHASIS"
>Qt Designer</I
>. Dynamic dialogs are 
<TT
CLASS="FILENAME"
>.ui</TT
> files which can be
executed by a Qt application; this keeps the GUI design and the code
separate and is useful in environments where the GUI may have to
change more often than the underlying application logic.</P
><DIV
CLASS="SECT1"
><H1
CLASS="SECT1"
><A
NAME="SUBCLASSING"
>Subclassing</A
></H1
><P
>We'll start with a general description of how to subclass a form and
follow with a short example.</P
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="TURNINGDESIGNERSUIFILESINTOSOURCECODE"
>Generating Source Code from <I
CLASS="EMPHASIS"
>Qt Designer</I
> .ui Files</A
></H2
><P
><I
CLASS="EMPHASIS"
>Qt Designer</I
> reads and writes 
<B
CLASS="COMMAND"
>qmake</B
> 
<TT
CLASS="FILENAME"
>.pro</TT
> (project)
files which are used to record the files used to build the application
and from which Makefiles are generated. <I
CLASS="EMPHASIS"
>Qt Designer</I
> also reads and writes

<TT
CLASS="FILENAME"
>.ui</TT
> (user interface) files. These are XML files
that record the widgets, layouts, source code and settings you've used
for a form. Every 
<TT
CLASS="FILENAME"
>.ui</TT
> file is converted by
the 
<B
CLASS="COMMAND"
>uic</B
> (user interface compiler) into a C++ 
<TT
CLASS="FILENAME"
>.h</TT
>
file and a C++ 
<TT
CLASS="FILENAME"
>.cpp</TT
> file. These C++ files are then
read by 
<B
CLASS="COMMAND"
>moc</B
> (meta object compiler), and finally compiled by your
compiler into a working application.</P
><P
>&#13;




If you create applications wholly within <I
CLASS="EMPHASIS"
>Qt Designer</I
> you only need to create a

<TT
CLASS="FILENAME"
>main.cpp</TT
> and add 
<TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="PROGRAMLISTING"
>SOURCES += main.cpp</PRE
></TD
></TR
></TABLE
>
at the end of your project's 
<TT
CLASS="FILENAME"
>.pro</TT
> file. You can
then use 
<B
CLASS="COMMAND"
>qmake</B
> to generate the Makefile. (For example
<TT
CLASS="LITERAL"
>qmake -o Makefile myproject.pro</TT
>.) Running 
<B
CLASS="COMMAND"
>make</B
>
(Linux, Unix or Borland compilers), or 
<B
CLASS="COMMAND"
>nmake</B
> (Visual C++), will
then call 
<B
CLASS="COMMAND"
>uic</B
>, 
<B
CLASS="COMMAND"
>moc</B
> and your compiler as necessary to build
your application.</P
><P
>&#13;






If you use <I
CLASS="EMPHASIS"
>Qt Designer</I
> to create your main window and dialogs, but also add
other C++ files, or if you subclass any of your forms you will need to
add these files to the 
<TT
CLASS="FILENAME"
>.pro</TT
> file so that they are
compiled with the rest of your application's source files. Each

<TT
CLASS="FILENAME"
>.h</TT
> file that you create separately from <I
CLASS="EMPHASIS"
>Qt Designer</I
> should
be added to the <TT
CLASS="LITERAL"
>HEADERS</TT
> line, and each

<TT
CLASS="FILENAME"
>.cpp</TT
> file should be added to the
<TT
CLASS="LITERAL"
>SOURCES</TT
> line, just as we've done for

<TT
CLASS="FILENAME"
>main.cpp</TT
>. If you get undefined reference errors it
is worth checking that you've added the names of all your header and
implementation files to the 
<TT
CLASS="FILENAME"
>.pro</TT
> file.</P
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="SUBCLASSINGAFORM"
>Subclassing a Form</A
></H2
><P
>&#13;
When subclassing a form it is helpful to use a naming convention 
to help us identify which files are generated from <I
CLASS="EMPHASIS"
>Qt Designer</I
>'s

<TT
CLASS="FILENAME"
>.ui</TT
> files and which are hand coded. </P
><P
>Suppose, for example, that we are developing a dialog and writing the
code directly in <I
CLASS="EMPHASIS"
>Qt Designer</I
>. We might call our dialog 'OptionsForm' and the

<TT
CLASS="FILENAME"
>.ui</TT
> file, <TT
CLASS="FILENAME"
>optionsform.ui</TT
>. The
automatically generated files will be <TT
CLASS="FILENAME"
>optionsform.h</TT
>
and <TT
CLASS="FILENAME"
>optionsform.cpp</TT
>.</P
><P
>If we were developing another dialog, but this time one that we intended
to subclass, we want to make it easy to distinguish between the
automatically generated files and our hand coded files. For example, we
might call our dialog 'SettingsFormBase' and the

<TT
CLASS="FILENAME"
>.ui</TT
> file <TT
CLASS="FILENAME"
>settingsformbase.ui</TT
>.
The automatically generated files would then be called
<TT
CLASS="FILENAME"
>settingsformbase.h</TT
> and
<TT
CLASS="FILENAME"
>settingsformbase.cpp</TT
>. We would then call our
subclass 'SettingsForm' and code it in the files
<TT
CLASS="FILENAME"
>settingsform.h</TT
> and
<TT
CLASS="FILENAME"
>settingsform.cpp</TT
>. </P
><P
>&#13;




Any subclass of a form should include the <TT
CLASS="LITERAL"
>Q_OBJECT</TT
>
macro so that slots and signals will work correctly. Once you've created
your subclass be sure to add the 
<TT
CLASS="FILENAME"
>.h</TT
> and the

<TT
CLASS="FILENAME"
>.cpp</TT
> files to the 
<TT
CLASS="FILENAME"
>.pro</TT
> project
file. For example we would add the following lines for our subclassed
'SettingsForm' at the end of the 
<TT
CLASS="FILENAME"
>.pro</TT
> file:
<TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="PROGRAMLISTING"
>HEADERS += settingsform.h
SOURCES += settingsform.cpp</PRE
></TD
></TR
></TABLE
>
<I
CLASS="EMPHASIS"
>Qt Designer</I
> will have added
<TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="PROGRAMLISTING"
>INTERFACES = settingsformbase.ui</PRE
></TD
></TR
></TABLE
>
to the project file. The <TT
CLASS="FILENAME"
>settingsformbase.h</TT
> and
<TT
CLASS="FILENAME"
>settingsformbase.cpp</TT
> files will be generated from
the 
<TT
CLASS="FILENAME"
>.ui</TT
> file automatically.</P
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="ASUBCLASSINGEXAMPLE"
>A Subclassing Example</A
></H2
><P
>We will write a small example dialog to show the use of subclassing in
practice. The dialog will present a choice of customer credit ratings
with an option of choosing a 'special' rating for which a specific
amount must be given. We'll implement the functionality in a subclass.
We'll start by creating the base form and connecting its signals and
slots, then we'll create the subclass and a simple

<TT
CLASS="FILENAME"
>main.cpp</TT
> so that we can test it.</P
><DIV
CLASS="SECT3"
><H3
CLASS="SECT3"
><A
NAME="AEN2895"
>Designing the Form</A
></H3
><P
>&#13;
We'll begin by creating a new project.
Click 
<SPAN
CLASS="GUIMENUITEM"
>File|New Project</SPAN
> to invoke the 
Project Settings
dialog, and type in a project
name of 'credit' and a project file name of 'credit.pro' then click
<SPAN
CLASS="GUIBUTTON"
>OK</SPAN
>. Now we'll add a form to the project.
Click 
<SPAN
CLASS="GUIMENUITEM"
>File|New</SPAN
> to invoke the 
New Form
dialog. The default form is Dialog which is what we want; click <SPAN
CLASS="GUIBUTTON"
>OK</SPAN
>.
Resize the form to make it smaller; it should be about 2 inches (5 cm)
square. Change the form's name to 'CustomerFormBase' and the caption to
'Credit Rating'. Save the form as 'customerformbase.ui'.</P
><P
>We'll now add the widgets we need.
<P
></P
><OL
TYPE="1"
><LI
><P
>Click the 

<SPAN
CLASS="GUIBUTTON"
>Button Group</SPAN
> toolbar button, then click
near the top left of the form. Resize the button group so that it takes
up approximately half the form. Change the button group's 
name to
'creditButtonGroup' and its 
title property to 'Credit Rating'.</P
></LI
><LI
><P
>We'll now add some radio buttons. <I
CLASS="EMPHASIS"
>Double</I
> click the


<SPAN
CLASS="GUIBUTTON"
>Radio Button</SPAN
> toolbar button. Click towards the
top of the Credit Rating button group and a radio button will appear.
Click below this button, to create a second radio button, then click
below the second button to create a third. Now we will switch off the
effect of the <I
CLASS="EMPHASIS"
>double</I
> click by clicking the

<SPAN
CLASS="GUIBUTTON"
>Pointer</SPAN
> (arrow) toolbar button. The pointer will now
behave normally, i.e. clicking the form will no longer create
more radio buttons. 
Change the first radio button's 
name to
'stdRadioButton' and its text to '&amp;Standard'. Change its 
checked
property to True. Change the second
button's name to 'noneRadioButton' and its text to '&amp;None'. Change
the third radio button's properties to 'specialRadioButton' and
'Sp&amp;ecial' respectively.</P
></LI
><LI
><P
>If the user chooses the special credit rating they must specify an amount.
Click the 

<SPAN
CLASS="GUIBUTTON"
>SpinBox</SPAN
> toolbar button and click the
form just below the button group. Change the spin box's 
name to
'amountSpinBox'. Change its 
prefix to '$ ' (note the space), its

maxValue to '100000' and its 
lineStep to '10000'. 
Change its 
enabled property to False.</P
></LI
><LI
><P
>Click the 

<SPAN
CLASS="GUIBUTTON"
>Push Button</SPAN
> toolbar button and click
the form below the spin box. Change the button's 
name to
'okPushButton', its 
text to 'OK' and its 
default 
property to 'True'. Add
a second button to the right of the first. Change the second button's

name to 'cancelPushButton' and its 
text to 'Cancel'.</P
></LI
></OL
></P
><P
>We'll now lay out the widgets and connect up the slots we need.
<P
></P
><OL
TYPE="1"
><LI
><P
>Click the form so that no widgets are selected. 
<B
CLASS="KEYCAP"
>Ctrl+Click</B
> the Standard
radio button and drag the rubber band so that it touches the other two
radio buttons, then release. Press 
<B
CLASS="KEYCAP"
>Ctrl+L</B
> (lay out
vertically). Click the Credit Rating button group, then press

<B
CLASS="KEYCAP"
>Ctrl+H</B
> (lay out horizontally).</P
></LI
><LI
><P
>Click the form so that the button group is no longer selected.

<B
CLASS="KEYCAP"
>Ctrl+Click</B
> the OK button and drag the rubber band to touch the Cancel
button, then release. Press 
<B
CLASS="KEYCAP"
>Ctrl+H</B
>.</P
></LI
><LI
><P
>Click the form, then press 
<B
CLASS="KEYCAP"
>Ctrl+L</B
>.</P
><P
>&#13;
The buttons expand to take up the full width of the form. It might look
more attractive to use spacers with them. Click the OK button, then
press 
<B
CLASS="KEYCAP"
>Ctrl+B</B
> (break layout). Resize both buttons to
make them narrower leaving space on either side of them. Click the


<SPAN
CLASS="GUIBUTTON"
>Spacer</SPAN
> toolbar button then click to the left of
the OK button; click Horizontal from the pop up spacer menu. Copy this
spacer and place the copy between the two buttons. Copy the spacer again
and place the copy to the right of the Cancel button. (For the second
and third spacers, click on the first spacer, press

<B
CLASS="KEYCAP"
>Ctrl+C</B
> then 
<B
CLASS="KEYCAP"
>Ctrl+V</B
>. Drag the new
spacer to the desired position.) Ctrl+Click the left most spacer and
drag the rubber band so that it touches the buttons and the spacers,
then release. Press 
<B
CLASS="KEYCAP"
>Ctrl+H</B
>.
Click the form then press 
<B
CLASS="KEYCAP"
>Ctrl+L</B
>.</P
></LI
></OL
></P
><P
>&#13;
We'll now connect the signals and slots. Press 
<B
CLASS="KEYCAP"
>F3</B
>
(connect signals/slots), then click the OK button. Drag to the form and
release. In the 
Edit Connections dialog that pops up connect the

<TT
CLASS="FUNCTION"
>clicked()</TT
> signal to the 
<TT
CLASS="FUNCTION"
>accept()</TT
> slot. (Click the

<TT
CLASS="FUNCTION"
>clicked()</TT
> signal, click the 
<TT
CLASS="FUNCTION"
>accept()</TT
> slot, then click <SPAN
CLASS="GUIBUTTON"
>OK</SPAN
>.)
Connect the Cancel button to the 
<TT
CLASS="FUNCTION"
>reject()</TT
> slot using the same
technique. </P
><P
>We want the amount spin box to be enabled only if the special radio
button is checked. Press 
<B
CLASS="KEYCAP"
>F3</B
> (connect signals/slots),
then click the
special radio button. Drag to the spin box and release. In the 

Edit Connections dialog that pops up click the 
<TT
CLASS="FUNCTION"
>toggled()</TT
>
signal and the 
<TT
CLASS="FUNCTION"
>setEnabled()</TT
> slot. </P
><P
>If the user checks the standard or none radio buttons we want to set the
amount accordingly. Press 
<B
CLASS="KEYCAP"
>F3</B
>,
then click the credit rating button group. Drag to the form and release.
Click the 
<TT
CLASS="FUNCTION"
>clicked()</TT
> signal.
We want to connect this signal to our own custom slot, but we
haven't created one yet. Click the <SPAN
CLASS="GUIBUTTON"
>Edit Slots</SPAN
>
button and the Edit Slots dialog will pop up. Click
<SPAN
CLASS="GUIBUTTON"
>New Slot</SPAN
> and change the Slot's name to
'setAmount()'. Click <SPAN
CLASS="GUIBUTTON"
>OK</SPAN
>. This new slot is now
available in the list of slots. Click the
<TT
CLASS="FUNCTION"
>setAmount()</TT
> slot then click <SPAN
CLASS="GUIBUTTON"
>OK</SPAN
>.</P
><P
>We'll subclass the form to set the amount in the spin box depending on
which radio button is checked. Save the form as 'creditformbase.ui' (press

<B
CLASS="KEYCAP"
>Ctrl+S</B
>). </P
></DIV
><DIV
CLASS="SECT3"
><H3
CLASS="SECT3"
><A
NAME="CREATINGTHETESTHARNESS"
>Creating the Test Harness</A
></H3
><P
>&#13;




Although we intend our dialog to be used within an application it is
useful to create a test harness so that we can develop and test it
stand-alone. We'll create a standard 
<TT
CLASS="FILENAME"
>main.cpp</TT
> as
follows:
<TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="PROGRAMLISTING"
>#include &lt;qapplication.h&gt;
#include "creditformbase.h"

int main( int argc, char *argv[] ) 
{
    QApplication app( argc, argv );

    CreditFormBase creditForm;
    app.setMainWidget( &amp;creditForm );
    creditForm.show();

    return app.exec();
}</PRE
></TD
></TR
></TABLE
>
Note that we're including <TT
CLASS="FILENAME"
>creditformbase.h</TT
> and
instantiating a CreditFormBase object; once
we've written our subclass we'll replace the header with our subclass,
<TT
CLASS="FILENAME"
>creditform.h</TT
>, and instantiate a CreditForm.</P
><P
>&#13;


Add 
<TT
CLASS="FILENAME"
>main.cpp</TT
> to the 
<TT
CLASS="FILENAME"
>credit.pro</TT
>
project file by adding the following line at the end:
<TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="PROGRAMLISTING"
>SOURCES += main.cpp</PRE
></TD
></TR
></TABLE
>
We can now generate the application with 
<B
CLASS="COMMAND"
>qmake</B
>, e.g.
<TT
CLASS="LITERAL"
>qmake -o Makefile credit.pro</TT
>, make it and run it.
The form should run fine, but doesn't yet have the behaviour we require.</P
></DIV
><DIV
CLASS="SECT3"
><H3
CLASS="SECT3"
><A
NAME="CREATINGTHESUBCLASS"
>Creating the Subclass</A
></H3
><P
>We need to create a header and an implementation file for our subclass.
The code for our subclass is minimal. The header file is
<TT
CLASS="FILENAME"
>qt/tools/designer/examples/credit/creditform.h</TT
>:
<TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="PROGRAMLISTING"
>#include &quot;creditformbase.h&quot;

class CreditForm : public CreditFormBase
{
    Q_OBJECT
public:
    CreditForm( <I
CLASS="EMPHASIS"
>QWidget</I
>* parent = 0, const char* name = 0, 
                bool modal = FALSE, WFlags fl = 0 );
    ~CreditForm();
public slots:
    void setAmount();
};</PRE
></TD
></TR
></TABLE
>




We've declared the slot, <TT
CLASS="FUNCTION"
>setAmount()</TT
>,
that we created in <I
CLASS="EMPHASIS"
>Qt Designer</I
>. The <TT
CLASS="LITERAL"
>Q_OBJECT</TT
> macro is
included because it is essential for classes that use signals and slots.</P
><P
>The implementation in 
<TT
CLASS="FILENAME"
>qt/tools/designer/examples/credit/creditform.cpp</TT
> is
simple:
<TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="PROGRAMLISTING"
>#include &lt;qradiobutton.h&gt;
#include &lt;qspinbox.h&gt;
#include &quot;creditform.h&quot;

CreditForm::CreditForm( <I
CLASS="EMPHASIS"
>QWidget</I
>* parent, const char* name, 
                        bool modal, WFlags fl )
    : CreditFormBase( parent, name, modal, fl ) 
{  
    setAmount(); 
}

CreditForm::~CreditForm() { <I
CLASS="EMPHASIS"
>/* NOOP */</I
> }

void CreditForm::setAmount() 
{
    if ( stdRadioButton-&gt;isChecked() )
        amountSpinBox-&gt;setValue( amountSpinBox-&gt;maxValue() / 2 );
    else if ( noneRadioButton-&gt;isChecked() )
        amountSpinBox-&gt;setValue( amountSpinBox-&gt;minValue() );
}</PRE
></TD
></TR
></TABLE
>
We call <TT
CLASS="FUNCTION"
>setAmount()</TT
> in the constructor to ensure
that the correct amount is shown when the form starts based on whichever
radio button we checked in <I
CLASS="EMPHASIS"
>Qt Designer</I
>. In <TT
CLASS="FUNCTION"
>setAmount()</TT
> we
set the amount if the standard or none radio button is checked. If the
user has checked the special radio button they are free to change the
amount themselves.</P
><P
>&#13;




To be able to test our subclass we change 
<TT
CLASS="FILENAME"
>main.cpp</TT
>
to include <TT
CLASS="FILENAME"
>creditform.h</TT
> rather than
<TT
CLASS="FILENAME"
>creditformbase.h</TT
> and change the instantiation of
the creditForm object:
<TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="PROGRAMLISTING"
>#include &lt;qapplication.h&gt;
#include &quot;creditform.h&quot;
int main( int argc, char *argv[] ) 
{
    <I
CLASS="EMPHASIS"
>QApplication</I
> app( argc, argv );

    CreditForm creditForm;
    app.setMainWidget( &amp;creditForm );
    creditForm.show();

    return app.exec();
}</PRE
></TD
></TR
></TABLE
>
We must also update the project file by adding two new lines at the end:
<TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="PROGRAMLISTING"
>HEADERS += creditform.h
SOURCES += creditform.cpp</PRE
></TD
></TR
></TABLE
>
To test the form rerun 
<B
CLASS="COMMAND"
>qmake</B
> to regenerate the Makefile, then make
and run.</P
><P
>The subclassing example we've used is simple, but this reflects
subclassing forms in Qt: it is easy to do. </P
></DIV
></DIV
></DIV
></DIV
><DIV
CLASS="NAVFOOTER"
><HR
ALIGN="LEFT"
WIDTH="100%"><TABLE
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
><A
HREF="iconview.html"
>Prev</A
></TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
><A
HREF="book1.html"
>Home</A
></TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
><A
HREF="creatingdynamicdialogsfromuifiles.html"
>Next</A
></TD
></TR
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
>IconView</TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
>&nbsp;</TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
>Creating Dynamic Dialogs from .ui Files</TD
></TR
></TABLE
></DIV
></BODY
></HTML
>