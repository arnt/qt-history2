#!
#! This is a custom template for creating a Makefile for the moc on Win32.
#!
#############################################################################
# Qt Makefile for the Meta Object Compiler (moc)
#
# The files mocgen.cpp and lex.yy.c are generated by yacc and lex.
#
# You'll need the Win32 GNU package in order to compile the moc from scratch.
# Get it from ftp://ftp.cygnus.com/pub/gnu-win32/win32
#
#############################################################################
#${
    StdInit();
    $tsrc = $project{"TOOLSRC"} . " " . $project{"MOCGEN"};
    $tobj = Objects($tsrc);
    $tobj =~ s=\.\.[\\/]tools[\\/]==g;
    $project{"OBJECTS"} = $tobj;
#$}
#$ IncludeTemplate("app.t");

####### Lex/yacc programs and options

LEX	=	flex
YACC	=	byacc -d

####### Lex/yacc files

LEXIN	=	#$ Expand("LEXINPUT");
LEXOUT  =	lex.yy.c
YACCIN	=	#$ Expand("YACCINPUT");
YACCOUT =	y.tab.c
YACCHDR =	y.tab.h
MOCGEN  =	#$ Expand("MOCGEN");

####### Process lex/yacc files

$(LEXOUT): $(LEXIN)
	$(LEX) $(LEXIN)

$(MOCGEN): moc.y $(LEXOUT)
	$(YACC) moc.y
	-del $(MOCGEN)
	-ren $(YACCOUT) $(MOCGEN)

####### Compile the C++ sources

#$ $text = Objects($project{"MOCGEN"}) . ": " . $project{"MOCGEN"};
#$ $text = "\t" . '$(CC) -c $(CFLAGS) $(INCPATH) -o ' . Objects($project{"MOCGEN"}) . " " . $project{"MOCGEN"};

#${
    @s = split(/\s+/,$project{"TOOLSRC"});
    foreach ( @s ) {
	$text && ($text .= "\n");
	$src = "..\\tools\\" . $_;
	$text .= Objects($_) . ": " . $src . "\n\t";
	$text .= '$(CC) -c $(CFLAGS) $(INCPATH) -o ';
	$text .= Objects($_) . " " . $src . "\n";
    }
#$}
