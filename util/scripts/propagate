#!/bin/sh

# to remove the need for the first test, do this:
# QTDIR=`pwd` export QTDIR

touch .test.$$
if [ '!' -f ${QTDIR}/.test.$$ ];
then
    echo
    echo
    echo '   The environment variable $QTDIR is not set correctly. It is currently'
    echo '   set to "'`echo $QTDIR`'", but it should be set to "'`pwd`'".'
    echo
    echo '   Please read the INSTALL file for instructions on how to set $QTDIR'
    echo '   correctly. If you have set $QTDIR in your .profile or .login, you '
    echo '   will need to log out and log in again to make the setting effective.'
    echo
    echo
    exit 1
fi
rm .test.$$

if [ -z "$1" -o '!' -f "$1" ];
then
    echo
    echo
    echo '   An internal error occurred, Qt cannot be built.'
    echo
    echo
    exit 2
fi

QTDIR='$(QTDIR)'

for a in `find . -name Makefile.in -print | sort` ; do
    N=`dirname $a`/Makefile
    M=${N}.in
    cat > $N <<EOF
#############################################################################
# Automatically generated from $M
# Build options from $1
#############################################################################

EOF
    cat .buildopts $1 $M >> $N
    echo '  Created' $N
done

touch variables
echo
echo Qt is now configured for building. Just run make.
echo To reconfigure, run make config.
echo
