#!/bin/sh

# to remove the need for the first test, do this:
# QTDIR=`pwd` export QTDIR

touch .test.$$
if [ '!' -f ${QTDIR}/.test.$$ ];
then
    echo
    echo
    echo '   $QTDIR must be set to $PWD ('`pwd`')'
    echo '   Please read INSTALL'
    echo
    echo
    exit 1
fi
rm .test.$$

if [ "$1" eq "" '!' -f $1 ];
then
    echo
    echo
    echo '   An error occured.  This is an error message'
    echo
    echo
    exit 2
fi

QTDIR='$(QTDIR)'

for a in `find . -name Makefile.in -print | sort` ; do
    N=`dirname $a`/Makefile
    M=${N}.in
    sed -ne '1,/##* BEGIN/ p' < $M > $N
    cat >> $N <<EOF
#
#   This section was automatically generated from
#      `pwd`/Makefile for building on
#      ${PLATFORM} on `date`
#

`cat $1`

####### End of automatically generated section
EOF
    sed -ne '/##* END/,$ p' < $M >> $N
    echo '  created' $N
done

touch variables
echo
echo Qt is now configured for building. Just run make.
echo To reconfigure, run make config.
echo
