#extracts the package to buildDir
extract     dest               "build_vc60_evaluation_________________PADDING_________________"
Section EXTRACT
extract     extUnpack          "qt-win-commercial-src-4.2.3.zip"
extract     extPatch           "qt-win-evalpatches-src-4.2.3.zip"
#delete line with "activeqt" in examples.pro file (don't build this)
delete      line               "build_vc60_evaluation_________________PADDING_________________\examples\examples.pro"  "activeqt"
SectionEnd

Section GETFILES
copy        extsync            addin60
copy        extsync            debugext
SectionEnd

#build the binaries
build       begin              vc60    "build_vc60_evaluation_________________PADDING_________________"

Section CONFIGURE
build       configure          "-confirm-license -release -plugin-sql-sqlite -plugin-sql-odbc -qt-libpng -qt-libjpeg -D QT_EVAL"
SectionEnd

Section BUILD
build       bin                sub-src-all
build       bin                sub-tools-make_first
build       binInDir           "tools\assistant\lib"        all
build       binInDir           "tools\designer\src"         sub-lib-all
build       binInDir           "tools\designer\src"         sub-components-all
build       binInDir           "tools\designer\src"         sub-uitools-all
build       binInDir           "tools\qtestlib"             all
build       bin                sub-demos-make_first
build       bin                sub-examples-make_first
build       dbPlugins
SectionEnd

build       finish

# organize release files
Section ORGANIZE
delete      dir                "release_vc60_evaluation"

copy        dest               "release_vc60_evaluation"
copy        src                "build_vc60_evaluation_________________PADDING_________________"

# extract everything once more
extract     dest               "release_vc60_evaluation"
extract     unpack             "qt-win-commercial-src-4.2.3.zip"

# create header files
copy        syncqt

delete      destDir            "src"
delete      destDir            "tools"
delete      destDir            "qmake"

# phrasebooks & porting .xml file
copy        files              "tools\linguist\phrasebooks\*.qph"         "phrasebooks\"
copy        files              "tools\porting\src\*.xml"                  ""

# copying program database files
copy        files              "lib\*.pdb"             "bin\"
copy        files              "src\winmain\*.pdb"     "src\winmain\"

# qconfig.h
copy        files              "src\corelib\global\qconfig.h"             "include\Qt\"

# qatomic.h
copy        fileAndRename      "src\corelib\arch\qatomic_windows.h"  "include\Qt\arch\qatomic.h"
copy        fileAndRename      "src\corelib\arch\qatomic_windows.h"  "include\QtCore\arch\qatomic.h"

# qconfig.pri
copy        file               "mkspecs\qconfig.pri"

# .qmake.cache
copy        file               ".qmake.cache"

# default mkspec
copy        files              "mkspecs\default\*"     "mkspecs\default\"

# copy all binary files
copy        all                "*.lib"
copy        all                "*.exe"
copy        all                "*.dll"

# .prl files
copy        files              "lib\*.prl"     "lib\"

# remove unused stuff
delete      files              "lib\*.dll"
delete      file               "configure.exe"

# copy some activeqt stuff needed to compile examples
copy        file               "src\activeqt\control\qaxserver.rc"
copy        file               "src\activeqt\control\qaxserver.ico"
copy        file               "src\activeqt\control\qaxserver.def"
SectionEnd

Section NSIS
# general installer options
installer   begin              "Qt Evaluation"
installer   version            "4.2.3"
installer   output             "c:\iwmake\qt-win-eval-4.2.3-vc60.exe"
installer   startmenu          "Qt by Trolltech v4.2.3 (Eval. VC60)"

installer   enable             component_page
installer   enable             directory_page
installer   enable             startmenu_page

installer   instdir            msvc     0     "Qt v4.2.3:"
installer   instdir            addin    1     "Visual Studio Add-In:"

installer   runfunction        "Run Examples and Demos"
installer   readmefunction     "Show Documentation"

# license checking
installer   module             licensecheck
installer   defineDir          licensecheck    licenseDir   "release_vc60_evaluation"
installer   define             licensecheck    productlist  "UnsupportedEvaluation|SupportedEvaluation|FullSourceEvaluation"

installer   module             evaluation
installer   module             environment
installer   module             registeruiext

# msvc options
installer   module             msvc
installer   src                msvc     "release_vc60_evaluation"
installer   makeFileList       msvc     "release_vc60_evaluation"
installer   buildDir           msvc     "build_vc60_evaluation_________________PADDING_________________"
installer   define             msvc     vc60

# help options
installer   module             addin60

# debugext options
installer   module             debugext

# compile the package
installer   compile
SectionEnd
