#!/bin/sh
# 
# Copyright 1997-2000 Troll Tech AS.  All rights reserved.
#

VERBOSE=
LIST=
SUBARGS=
SYMLINKS=
UTILS="mergetr msg2qm"
while [ -n "$2" ]
do
    case "$1" in
       -v) VERBOSE=1
    ;; -p) LIST=1
	    SUBARGS="$SUBARGS $1"
    ;; -s) SYMLINKS="symlinks "
    esac
    shift
done

PLATFORM=$1

cd ${QTDIR}
unset CPLUS_INCLUDE_DIR
QT_VERSION=`perl -n -e 'if (/#define\s+QT_VERSION\s+(\d)(\d+)/) { $maj=$1; $min=$2; $min =~ s/00/0/; print "$maj.$min\n";}' src/tools/qglobal.h`

if [ -n "$LIST" ] ; then echo Makefile ; fi

exec > Makefile

cat <<EOF
# -*- makefile -*-
#
# Main Makefile for building the Qt library, examples and tutorial.
# Read PORTING for instructions how to port Qt to a new platform.


all: $SYMLINKS moc src util tutorial examples
	@echo
	@echo "The Qt library is now built in ./lib"
	@echo "The Qt examples are built in the directories in ./examples"
	@echo "The Qt tutorials are built in the directories in ./tutorial"
	@echo
	@echo "Enjoy!   - the Troll Tech team"
	@echo

moc: .buildopts FORCE
	cd src/moc; \$(MAKE)
	-mkdir bin
	-rm -f bin/moc
	cp src/moc/moc bin/moc

util: $UTILS

mergetr: src FORCE
	cd src/util/mergetr; \$(MAKE)
	cp src/util/mergetr/mergetr bin/mergetr

msg2qm: src FORCE
	cd src/util/msg2qm; \$(MAKE)
	cp src/util/msg2qm/msg2qm bin/msg2qm

qvfb: src FORCE
	cd src/util/qvfb; \$(MAKE)
	cp src/util/qvfb/qvfb bin/qvfb

symlinks:
	@cd include; rm -f q*.h; ln -s ../src/*/q*.h .; ln -s ../extensions/*/src/q*.h .; rm -f q*_p.h

src: moc .buildopts FORCE
	cd \$@; \$(MAKE)

tutorial examples: src FORCE
	cd \$@; \$(MAKE)

clean:
	-rm .buildopts
	cd src/moc; \$(MAKE) clean
	cd src; \$(MAKE) clean
	cd tutorial; \$(MAKE) clean
	cd examples; \$(MAKE) clean

depend:
	cd src; \$(MAKE) depend
	cd tutorial; \$(MAKE) depend
	cd examples; \$(MAKE) depend

.buildopts: Makefile
	@echo
	@echo '  You must run the configure script before you can build Qt.'
	@echo
	@echo '  The make process will now abort with an error.'
	@echo
	@exit 1

dep: depend

FORCE:


EOF
