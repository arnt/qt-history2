#!/bin/sh

IPv6IFNAME=0
QMKSPEC=$1
VERBOSE=$2
SRCDIR=$3
OUTDIR=$4

# debuggery
[ "$VERBOSE" = "yes" ] && echo "Testing IPv6 interface name support..."

# build a test program
test -d $OUTDIR/config.tests/unix/ipv6ifname  || mkdir -p $OUTDIR/config.tests/unix/ipv6ifname
$OUTDIR/bin/qmake -nocache -spec "$QMKSPEC" $SRCDIR/config.tests/unix/ipv6ifname/ipv6ifname.pro -o $OUTDIR/config.tests/unix/ipv6ifname/Makefile >/dev/null 2>&1
cd $OUTDIR/config.tests/unix/ipv6ifname

if [ "$VERBOSE" = "yes" ]; then
  make
else
  make >/dev/null 2>&1
fi
IPv6IFNAME=$?

# done
if [ "$IPv6IFNAME" -ne 0 ]; then
    [ "$VERBOSE" = "yes" ] && echo "IPv6 interface name support disabled."
    exit 0
else
    [ "$VERBOSE" = "yes" ] && echo "IPv6 interface name support enabled."
    exit 1
fi
