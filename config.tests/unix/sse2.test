#!/bin/sh

FVISIBILITY_SUPPORT=no
COMPILER=$1
VERBOSE=$2

cat >>sse2.c << EOF
#include <emmintrin.h>
#if defined(__GNUC__) && __GNUC__ < 4 && __GNUC_MINOR__ < 3
#error GCC < 3.2 is known to create internal compiler errors with our SSE2 code
#endif
EOF

$COMPILER -c -msse2 sse2.c >/dev/null 2>&1 && SSE2_SUPPORT=yes
rm -f sse2.c sse2.o

# done
if [ "$SSE2_SUPPORT" != "yes" ]; then
    [ "$VERBOSE" = "yes" ] && echo "SSE2 support disabled."
    exit 0
else
    [ "$VERBOSE" = "yes" ] && echo "SSE2 support enabled."
    exit 1
fi
