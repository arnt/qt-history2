#!/bin/sh

QMKSPEC=$1
VERBOSE=$2
SRCDIR=$3
OUTDIR=$4

# debuggery

if [ "$VERBOSE" = "yes" ]; then
    echo "Testing STL support... ($*)"
fi

# ?

ABSPATH=
if [ "$SRCDIR" != "$OUTDIR" ]; then
    ABSPATH="QMAKE_ABSOLUTE_SOURCE_PATH=$SRCDIR/config.tests/unix"
fi

test -d $OUTDIR/config.tests/unix/stl || mkdir -p $OUTDIR/config.tests/unix/stl
$OUTDIR/bin/qmake -nocache -spec "$QMKSPEC" "$ABSPATH" $SRCDIR/config.tests/unix/stl/stltest.pro -o $OUTDIR/config.tests/unix/stl/Makefile >/dev/null 2>&1
cd $OUTDIR/config.tests/unix/stl

if [ "$VERBOSE" = "yes" ]; then
  make || exit 0
  ./stltest
else
  make >/dev/null 2>&1 || exit 0
  ./stltest >/dev/null 2>&1
fi
