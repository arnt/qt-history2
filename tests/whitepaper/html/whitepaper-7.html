<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<!-- ./databases.leaf:3 -->
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
<title>Databases</title>
</head>
<body>
<p align="right">[<a href="whitepaper-6.html">Prev: 2D and 3D Graphics</a>] [<a href="whitepaper.html">Home</a>] [<a href="whitepaper-8.html">Next: Internationalization</a>]</p>
<h2 align="center">Databases</h2>
<!-- index databases --><blockquote>
<p>The Qt SQL module simplifies the creation of cross-platform GUI database applications. Programmers can easily execute SQL statements, use database-specific widgets, and make any widget data aware.</p>
</blockquote>
<!-- index Microsoft SQL Server --><!-- index MySQL --><!-- index OCI --><!-- index ODBC --><!-- index Oracle --><!-- index PostgreSQL --><!-- index SQL --><!-- index Sybase --><!-- index TDS --><p>The Qt SQL module provides a cross-platform interface for accessing SQL databases. Qt includes native drivers for Oracle, Microsoft SQL Server, Sybase Adaptive Server, PostgreSQL, MySQL and ODBC. The drivers work on all platforms supported by Qt, and programs can access multiple databases using multiple drivers simultaneously.</p>
<p>Programmers can easily execute any arbitrary SQL statements. Qt also provides a high-level C++ interface that programmers can use to generate the appropriate SQL statements automatically.</p>
<!-- index keys --><!-- index primary keys --><p>Any Qt widget, including custom widgets, can be made data aware. Qt also includes some database-specific convenience widgets, to simplify the creation of dialogs and windows that present records as forms or in tables. Data-aware widgets automatically support browsing, updating and deleting records. Most database designs require that new records have a unique key that cannot be guessed by Qt, so insertion usually needs a small amount of code to be written. The programmer can easily force the user to confirm actions, e.g. deletions.</p>
<!-- index Designer --><!-- index Qt Designer --><p>Qt's SQL module is fully integrated into <a href="whitepaper-5.html">Qt Designer</a>, which provides templates and wizards to make the creation of database forms as quick and easy as possible. The wizards can create forms with navigation buttons, and with update, insert and delete buttons.</p>
<p>Using the facilities that the Qt SQL module provides, it is straightforward to create database applications that use foreign key lookups, present master-detail relationships, and support drill-down.</p>
<h3><a name="1"></a>Executing SQL Commands</h3>
<!-- index DDL --><!-- index DML --><!-- index SELECT --><!-- index queries --><p>The <font color=darkblue><b>QSqlQuery</b></font> class is used to directly execute SQL DDL and DML statements. It is also used to navigate the result sets produced by <tt>SELECT</tt> statements.</p>
<p>In the example below, a query is executed, and the result set navigated using <font color=darkblue>QSqlQuery::next()</font>:</p>
<pre>
    QSqlQuery query( "SELECT id, surname FROM staff" );
    while ( query.next() ) {
	cout &lt;&lt; "id: "
	     &lt;&lt; query.value( 0 ).toInt()
	     &lt;&lt; " surname: "
	     &lt;&lt; query.value( 1 ).toString() &lt;&lt; endl;
    }
</pre>
<p>Field values are indexed in the order they appear in the <tt>SELECT</tt> statement. <font color=darkblue><b>QSqlQuery</b></font> also provides the <font color=darkblue>first()</font>, <font color=darkblue>prev()</font>, <font color=darkblue>last()</font> and <font color=darkblue>seek()</font> navigation functions.</p>
<p><tt>INSERT</tt>, <tt>UPDATE</tt> and <tt>DELETE</tt> are equally simple. Below is an <tt>UPDATE</tt> example:</p>
<pre>
    QSqlQuery query( "UPDATE staff SET salary = salary * 1.10"
		     " WHERE id &gt; 1155 AND id &lt; 8155" );
    if ( query.isActive() ) {
	cout &lt;&lt; "Pay rise given to "
	     &lt;&lt; query.numRowsAffected()
	     &lt;&lt; " staff" &lt;&lt; endl;
    }
</pre>
<!-- index views --><p>For programmers who are not comfortable writing raw SQL, the <font color=darkblue><b>QSqlCursor</b></font> class provides a high-level interface for browsing and editing records in SQL tables or views without the need to write SQL statements. For example:</p>
<pre>
    QSqlCursor cur( "staff" );
    while ( cur.next() ) {
	cout &lt;&lt; "id: "
	     &lt;&lt; cur.value( "id" ).toInt()
	     &lt;&lt; " surname: "
	     &lt;&lt; cur.value( "surname" ).toString() &lt;&lt; endl;
    }
</pre>
<p><font color=darkblue><b>QSqlCursor</b></font> also supports the ordering and filtering that are achieved using the <tt>ORDER</tt> <tt>BY</tt> and <tt>WHERE</tt> clauses in SQL statements.</p>
<!-- index calculated fields --><!-- index foreign keys --><p>Calculated fields are useful both for real calculations (e.g. calculating totals) and for performing foreign key lookups, (e.g. to display names rather than codes). Calculated fields can be created by subclassing <font color=darkblue><b>QSqlCursor</b></font>, adding additional <font color=darkblue><b>QSqlField</b></font>s with their calculated property set to TRUE, and by reimplementing <font color=darkblue>QSqlCursor::calculateField()</font>.</p>
<!-- index commit --><!-- index rollback --><!-- index transactions --><p>Database drivers usually supply data as strings, regardless of the actual datatype. Qt handles such data seamlessly using the <font color=darkblue><b>QVariant</b></font> class. Database drivers can be asked about the features they support, including query-size reporting and transactions. The <font color=darkblue>transaction()</font>, <font color=darkblue>commit()</font> and <font color=darkblue>rollback()</font> functions can be used if the database supports transactions.</p>
<h3><a name="2"></a>Data-aware Widgets</h3>
<!-- index data table --><!-- index table --><p><font color=darkblue><b>QDataTable</b></font> is a <font color=darkblue><b>QTable</b></font> that displays records from a result set using a <font color=darkblue><b>QSqlCursor</b></font>. <font color=darkblue><b>QDataTable</b></font>, like <font color=darkblue><b>QTable</b></font>, supports in-place editing. Programmers can force users to confirm all or selected changes (e.g. deletions) by setting <font color=darkblue><b>QDataTable</b></font>'s confirmation properties. The editor widget chosen for each type of data depends on the data type. For example, a <font color=darkblue><b>QLineEdit</b></font> is used for <tt>CHAR</tt> fields, whereas a <font color=darkblue><b>QSpinBox</b></font> is used for <tt>INTEGER</tt> fields. The programmer can override the defaults by creating a property map for the table, which matches fields (columns) to the editor widget type the programmer prefers.</p>
<p>Records can be updated and deleted without writing any code. Insertions require some code since most database designs expect new records to be created with a unique key. This can easily be achieved by generating the key in a slot connected to the <font color=darkblue>QDataTable::beforeInsert()</font> signal.</p>
<p><font color=darkblue><b>QDataTable</b></font> uses intelligent buffering to make the loading of large result sets fast, while keeping the user interface responsive. For databases that are capable of reporting query sizes, the scroll bar slider is displayed proportionally immediately.</p>
<p>Qt also includes <font color=darkblue><b>QDataBrowser</b></font> and <font color=darkblue><b>QDataView</b></font> to display records as forms, typically with one or perhaps just a few records shown at a time. These classes provide buttons with ready-made connections for navigating through the records. <font color=darkblue><b>QDataView</b></font> is used for read-only data. <font color=darkblue><b>QDataBrowser</b></font> is used for editing, and can provide ready-made insert, update and delete buttons.</p>
<!-- index context menu --><!-- index popup menu --><p><font color=darkblue><b>QDataTable</b></font> and <font color=darkblue><b>QDataBrowser</b></font> have both a popup context menu and keyboard shortcuts for editing records.</p>
<!-- index foreign keys --><p>Programmers can manipulate data retrieved from the database before it is displayed by implementing a slot and connecting it to the <font color=darkblue>primeInsert()</font> and <font color=darkblue>primeUpdate()</font> signals. Data can also be manipulated or actions logged just before changes are written back to the database, for example, converting a foreign key's display text into its ID by implementing a slot connected to <font color=darkblue>beforeInsert()</font>, <font color=darkblue>beforeUpdate()</font> and <font color=darkblue>beforeDelete()</font>.</p>
<!-- index forms --><p>Developers can create their own forms for displaying database records. Unlike older toolkits that duplicate their widgets with data-aware versions, any Qt widget (including custom widgets) can be made data aware. All that is necessary is to include the widget in a <font color=darkblue><b>QSqlForm</b></font> and set up a property map to relate the relevant database field to the widget that will present and edit the field's data.</p>
<!-- index drill-down --><!-- index master-detail --><p>Master-detail relationships are easily set up by filtering the detail form or table's cursor by the master form or table's current record. Drill-down is also easy to achieve by associating a button, menu item or keyboard shortcut with a drill-down form that is invoked with the current record's key as a parameter.</p>
<!-- index Designer --><!-- index Qt Designer --><!-- index wizards --><p>Qt's SQL module is fully integrated with <a href="whitepaper-5.html">Qt Designer</a>. <a href="whitepaper-5.html">Qt Designer</a> can preview database forms and tables using live data if desired, allowing developers to browse, delete and update records. <a href="whitepaper-5.html">Qt Designer</a> has templates and wizards to make creating database forms fast and simple.</p>
<p><hr><ul> <li><a href=http://doc.trolltech.com/3.0/sql.html>http://doc.trolltech.com/3.0/sql.html</a> </ul></p>
<!-- eof -->
<p align="right">[<a href="whitepaper-6.html">Prev: 2D and 3D Graphics</a>] [<a href="whitepaper.html">Home</a>] [<a href="whitepaper-8.html">Next: Internationalization</a>]</p>
</body>
</html>
